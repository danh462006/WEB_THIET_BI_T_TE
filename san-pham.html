<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh s√°ch s·∫£n ph·∫©m</title>
    <link rel="icon" type="image/png" href="hinh-anh/logo-favicon.png">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="category-style.css">
    <link rel="stylesheet" href="profile-modal.css">
    <link rel="stylesheet" href="mobile-responsive.css">
    <style>
        :root {
            --bg: #f6f7fb;
            --card: #ffffff;
            --border: #e5e7eb;
            --text: #111827;
            --muted: #6b7280;
            --primary: #0d6efd;
            --accent: #28a745;
            --danger: #dc3545;
            --shadow: 0 10px 30px rgba(17, 24, 39, 0.08);
        }
        
        .page { display: flex; gap: 16px; padding: 20px; align-items: flex-start; }
        .filter-panel { width: 25%; background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 16px; box-shadow: var(--shadow); position: sticky; top: 12px; max-height: 90vh; overflow-y: auto; transition: transform 0.3s ease; }
        .filter-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
        .filter-header h3 { margin: 0; font-size: 18px; }
        .filter-close { display: none; background: none; border: none; font-size: 20px; cursor: pointer; color: var(--muted); }

        .filter-block { margin-bottom: 16px; border-bottom: 1px solid var(--border); padding-bottom: 12px; }
        .filter-block:last-child { border-bottom: none; padding-bottom: 0; margin-bottom: 0; }
        .filter-block h4 { margin: 0 0 8px 0; font-size: 15px; }
        .filter-options { display: grid; gap: 6px; grid-template-columns: 1fr; }
        .filter-option { display: flex; align-items: center; gap: 8px; font-size: 14px; }
        .filter-option input { accent-color: var(--primary); }
        .filter-actions { display: flex; gap: 10px; }
        .btn { border: none; border-radius: 10px; padding: 10px 12px; font-weight: 600; cursor: pointer; font-size: 14px; }
        .btn-primary { background: var(--primary); color: #fff; }
        .btn-outline { background: #fff; color: var(--text); border: 1px solid var(--border); }

        .content-area { width: 75%; display: flex; flex-direction: column; gap: 14px; }
        .content-header { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
        .result-count { font-weight: 700; }
        .sort-select { padding: 10px 12px; border-radius: 10px; border: 1px solid var(--border); background: #fff; font-size: 14px; }
        .mobile-filter-toggle { display: none; padding: 10px 12px; border-radius: 10px; border: 1px solid var(--border); background: #fff; cursor: pointer; }

        .type-panel { background: #fff; border: 1px solid var(--border); border-radius: 12px; padding: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.04); }
        .type-panel h3 { margin: 0 0 10px 0; font-size: 16px; }
        .type-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; }
        .type-card { background: #fff; border: 1px solid var(--border); border-radius: 10px; padding: 10px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; }
        .type-card.active { border-color: var(--primary); box-shadow: 0 0 0 2px rgba(13,110,253,0.12); }
        .type-card span { color: var(--muted); font-size: 13px; }

        .product-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); 
            gap: 14px;
        }
        @media (min-width: 1200px) {
            .product-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        .product-card { 
            background: #fff; 
            border: 1px solid var(--border); 
            border-radius: 12px; 
            padding: 12px; 
            box-shadow: 0 4px 16px rgba(0,0,0,0.04); 
            display: flex; 
            flex-direction: column; 
            gap: 8px; 
            transition: transform 0.15s ease, box-shadow 0.15s ease;
            height: 380px; /* Fixed height for consistent card size */
        }
        .product-card:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,0,0,0.08); }
        .product-card img { 
            width: 100%; 
            height: 150px; 
            object-fit: cover; 
            border-radius: 10px; 
            background: #f3f4f6;
            flex-shrink: 0; /* Prevent image from shrinking */
        }
        .product-name { 
            font-weight: 700; 
            font-size: 15px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            min-height: 42px;
            max-height: 42px;
        }
        .product-price { 
            color: #d97706; 
            font-weight: 700;
            margin-top: auto; /* Push to bottom */
        }
        .product-rating { color: #f59e0b; font-size: 13px; }
        .product-actions { 
            display: flex; 
            gap: 8px;
            margin-top: 8px;
        }
        .product-actions .btn { flex: 1; padding: 10px; font-size: 13px; }

        .pagination { display: flex; gap: 8px; align-items: center; justify-content: center; padding: 10px 0 20px; flex-wrap: wrap; }
        .page-btn { padding: 8px 12px; border: 1px solid var(--border); background: #fff; border-radius: 10px; cursor: pointer; min-width: 40px; }
        .page-btn.active { background: var(--primary); color: #fff; border-color: var(--primary); }
        .page-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        .price-inputs { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
        .price-inputs input { padding: 10px; border-radius: 10px; border: 1px solid var(--border); font-size: 14px; }

        .skeleton { position: relative; overflow: hidden; background: #e5e7eb; border-radius: 10px; }
        .skeleton::after { content: ""; position: absolute; inset: 0; background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.6) 50%, rgba(255,255,255,0) 100%); animation: shimmer 1.2s infinite; }
        @keyframes shimmer { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }

        .filter-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 900; }
        .filter-panel.mobile { position: fixed; inset: 0 30% 0 0; max-height: none; z-index: 901; transform: translateX(-100%); }
        .filter-panel.mobile.open { transform: translateX(0); }

        /* Search Suggestions Dropdown */
        .search-section { position: relative; }
        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid var(--border);
            border-top: none;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            max-height: 400px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
            margin-top: -1px;
        }
        .search-suggestions.show { display: block; }
        .suggestion-item {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            border-bottom: 1px solid var(--border);
            transition: background-color 0.2s ease;
        }
        .suggestion-item:last-child { border-bottom: none; }
        .suggestion-item:hover { background-color: #f3f4f6; }
        .suggestion-img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 8px;
            background: #f3f4f6;
            flex-shrink: 0;
        }
        .suggestion-info {
            flex: 1;
            min-width: 0;
        }
        .suggestion-name {
            font-weight: 600;
            font-size: 14px;
            color: var(--text);
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .suggestion-sku {
            font-size: 12px;
            color: var(--muted);
        }
        .suggestion-price {
            font-weight: 700;
            color: #d97706;
            font-size: 14px;
            white-space: nowrap;
        }
        .suggestion-empty {
            padding: 20px;
            text-align: center;
            color: var(--muted);
            font-size: 14px;
        }
        .suggestion-highlight {
            background-color: #fef3c7;
            font-weight: 600;
        }

        /* Product Detail View */
        .product-detail-view {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
        }
        .product-detail-view.show { display: block; }
        .back-to-list {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 20px;
            transition: all 0.2s;
        }
        .back-to-list:hover {
            background: #0b5ed7;
            transform: translateX(-2px);
        }
        .product-detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        .product-gallery {
            position: relative;
        }
        .product-main-image {
            width: 100%;
            height: 400px;
            object-fit: contain;
            border-radius: 12px;
            background: #f9fafb;
            margin-bottom: 15px;
        }
        .product-thumbnails {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
        }
        .product-thumbnail {
            width: 100%;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        .product-thumbnail:hover { border-color: var(--primary); }
        .product-thumbnail.active { border-color: var(--primary); }
        .product-info h1 {
            font-size: 24px;
            margin-bottom: 15px;
            color: var(--text);
        }
        .product-sku-info {
            color: var(--muted);
            margin-bottom: 15px;
            font-size: 14px;
        }
        .product-price-section {
            background: #fef3c7;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        .product-current-price {
            font-size: 32px;
            font-weight: 700;
            color: #d97706;
            margin-bottom: 8px;
        }
        .product-original-price {
            font-size: 18px;
            color: var(--muted);
            text-decoration: line-through;
        }
        .product-stock {
            padding: 10px 15px;
            background: #d1fae5;
            color: #065f46;
            border-radius: 8px;
            display: inline-block;
            margin-bottom: 20px;
            font-weight: 600;
        }
        .product-actions-modal {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }
        .product-actions-modal .btn {
            flex: 1;
            padding: 15px;
            font-size: 16px;
        }
        .product-description-section {
            border-top: 2px solid var(--border);
            padding-top: 30px;
        }
        .product-description-section h2 {
            font-size: 20px;
            margin-bottom: 15px;
            color: var(--text);
        }
        .product-description-section p {
            line-height: 1.8;
            color: #4b5563;
            white-space: pre-wrap;
        }
        .product-specs {
            background: #f9fafb;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }

        /* Comments Section */
        .product-comments-section {
            border-top: 2px solid var(--border);
            padding-top: 30px;
            margin-top: 30px;
        }
        .product-comments-section h2 {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--text);
        }
        .product-comments-section h3 {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--text);
        }
        .comment-form-wrapper {
            background: #f9fafb;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        .comment-form .form-group {
            margin-bottom: 15px;
        }
        .comment-form input[type="text"],
        .comment-form textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
        }
        .comment-form textarea {
            resize: vertical;
        }
        .rating-input {
            margin-bottom: 15px;
        }
        .rating-input label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        .star-rating {
            display: flex;
            flex-direction: row-reverse;
            justify-content: flex-end;
            gap: 5px;
        }
        .star-rating input {
            display: none;
        }
        .star-rating label {
            cursor: pointer;
            font-size: 30px;
            color: #d1d5db;
            transition: color 0.2s;
        }
        .star-rating input:checked ~ label,
        .star-rating label:hover,
        .star-rating label:hover ~ label {
            color: #fbbf24;
        }
        .comments-list {
            margin-top: 20px;
        }
        .comment-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            margin-bottom: 15px;
        }
        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        .comment-author {
            font-weight: 600;
            color: var(--text);
            font-size: 16px;
        }
        .comment-rating {
            color: #fbbf24;
            font-size: 16px;
        }
        .comment-date {
            color: #6b7280;
            font-size: 13px;
            margin-bottom: 10px;
        }
        .comment-text {
            color: #4b5563;
            line-height: 1.6;
        }
        .product-specs h3 {
            font-size: 18px;
            margin-bottom: 15px;
        }
        .product-loading {
            text-align: center;
            padding: 60px;
            color: var(--muted);
        }
        @media (max-width: 768px) {
            .product-detail-grid { grid-template-columns: 1fr; }
            .product-modal-body { padding: 20px; }
            .product-main-image { height: 300px; }
        }

        @media (max-width: 1024px) {
            .filter-panel { width: 30%; }
            .content-area { width: 70%; }
        }

        @media (max-width: 768px) {
            .page { flex-direction: column; padding: 12px; gap: 12px; }
            .content-area { width: 100%; }
            .filter-panel { display: none; }
            .filter-panel.mobile { display: block; width: 85%; max-width: 320px; }
            .mobile-filter-toggle { display: inline-flex; align-items: center; gap: 6px; }
            .filter-close { display: inline-block; }
            
            /* Product grid mobile */
            .product-grid { 
                grid-template-columns: repeat(2, 1fr); 
                gap: 10px; 
            }
            .product-card { 
                padding: 10px; 
            }
            .product-card img { 
                height: 140px; 
            }
            .product-name { 
                font-size: 13px; 
                -webkit-line-clamp: 2;
                line-clamp: 2;
            }
            .product-price { 
                font-size: 13px; 
            }
            
            /* Type cards mobile */
            .type-grid { 
                grid-template-columns: repeat(2, 1fr); 
                gap: 8px; 
            }
            .type-card { 
                padding: 8px; 
                font-size: 13px;
            }
            .type-card span { 
                font-size: 11px; 
            }
            
            /* Product detail modal */
            .product-detail-grid { 
                grid-template-columns: 1fr; 
            }
            .product-modal-body { 
                padding: 16px; 
            }
            .product-main-image { 
                height: 280px; 
            }
            .product-thumbnails {
                gap: 8px;
            }
            .product-thumbnail {
                width: 60px;
                height: 60px;
            }
            
            /* Modal adjustments */
            .product-modal {
                padding: 0;
            }
            .product-modal-content {
                margin: 0;
                border-radius: 0;
                max-height: 100vh;
            }
            
            /* Header mobile */
            .content-header { 
                gap: 8px; 
            }
            .result-count { 
                font-size: 14px; 
            }
            .sort-select { 
                padding: 8px 10px; 
                font-size: 13px; 
            }
            
            /* Pagination mobile */
            .pagination { 
                gap: 6px; 
                padding: 8px 0 16px; 
            }
            .page-btn { 
                padding: 6px 10px; 
                min-width: 36px; 
                font-size: 13px; 
            }
        }
        
        @media (max-width: 480px) {
            .page { padding: 8px; }
            
            /* Single column on very small screens */
            .product-grid { 
                grid-template-columns: 1fr; 
            }
            .product-card img { 
                height: 200px; 
            }
            
            .type-grid { 
                grid-template-columns: 1fr; 
            }
            
            .product-main-image { 
                height: 250px; 
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo-section">
                <img src="hinh-anh/logo.png" alt="TBYT ƒê·ª©c Ph∆∞∆°ng" class="logo">
            </div>
            
            <div class="search-section">
                <div class="search-box">
                    <input type="text" placeholder="T√¨m Ki·∫øm ..." class="search-input" autocomplete="off" name="search_q_xyz" readonly onfocus="this.removeAttribute('readonly'); this.value='';">
                    <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        var searchInput = document.querySelector('.search-input');
                        if (searchInput) {
                            searchInput.value = '';
                            setTimeout(function(){ searchInput.value = ''; }, 100);
                            setTimeout(function(){ searchInput.value = ''; }, 500);
                        }
                    });
                    </script>
                    <button class="search-btn">üîç</button>
                </div>
                <div class="search-suggestions" id="searchSuggestions"></div>
            </div>
            
            <div class="user-section">
                <div class="account-dropdown">
                    <button class="account-btn" onclick="handleAccountClick(event)">
                        <img src="hinh-anh/icon_tk.png" alt="T√†i kho·∫£n" class="account-icon">
                    </button>
                    <div id="usernameDisplay" class="username-display" style="display: none;"></div>
                    <div class="account-menu" id="accountMenu" style="min-width: 150px; right: 0; left: auto;">
                        <a href="#" onclick="event.stopPropagation(); openProfileModal(); return false;">Th√¥ng tin t√†i kho·∫£n</a>
                        <a href="#">ƒê∆°n h√†ng c·ªßa t√¥i</a>
                        <a href="#" onclick="event.stopPropagation(); /* handleLogout if available */ return false;">ƒêƒÉng xu·∫•t</a>
                    </div>
                </div>
                <button class="cart-btn">üõí Gi·ªè h√†ng</button>
                <div class="dropdown">
                    <button class="dropdown-btn">üìã Danh m·ª•c ‚ñº</button>
                    <div class="dropdown-content">
                        <a href="index.html">Trang ch·ªß</a>
                        <div class="dropdown-item-with-submenu">
                            <a href="#" class="has-submenu">S·∫£n ph·∫©m</a>
                            <div class="submenu">
                                <div class="submenu-content">
                                    <div class="category-header">
                                        <h3>üî• G·ª£i √Ω cho b·∫°n</h3>
                                    </div>
                                    
                                    <div class="category-brands">
                                        <div class="brand-item" data-category="Gi∆∞·ªùng"><img src="icon-hinhdanhmuc/nhom-giuong.png" alt="Gi∆∞·ªùng" class="category-icon">Gi∆∞·ªùng</div>
                                        <div class="brand-item" data-category="Xe lƒÉn"><img src="icon-hinhdanhmuc/nhom-xelan.png" alt="Xe lƒÉn" class="category-icon">Xe lƒÉn</div>
                                        <div class="brand-item" data-category="Xe Scooter ƒëi·ªán"><img src="icon-hinhdanhmuc/nhom-xedien.png" alt="Xe Scooter ƒëi·ªán" class="category-icon">Xe Scooter ƒëi·ªán</div>
                                        <div class="brand-item" data-category="BƒÉng ca"><img src="icon-hinhdanhmuc/nhom-bangca.png" alt="BƒÉng ca" class="category-icon">BƒÉng ca</div>
                                        <div class="brand-item" data-category="T·ªß"><img src="icon-hinhdanhmuc/nhom-tu.png" alt="T·ªß" class="category-icon">T·ªß</div>
                                        <div class="brand-item" data-category="M√°y t·∫°o oxy"><img src="icon-hinhdanhmuc/nhom-maytaooxy.png" alt="M√°y t·∫°o oxy" class="category-icon">M√°y t·∫°o oxy</div>
                                        <div class="brand-item" data-category="M√°y ƒëo"><img src="icon-hinhdanhmuc/nhom-maydo.png" alt="M√°y ƒëo" class="category-icon">M√°y ƒëo</div>
                                        <div class="brand-item" data-category="M√°y x√¥ng"><img src="icon-hinhdanhmuc/nhom-xong.png" alt="M√°y x√¥ng" class="category-icon">M√°y x√¥ng</div>
                                        <div class="brand-item" data-category="M√°y h√∫t d·ªãch"><img src="icon-hinhdanhmuc/nhom-mayhutdich.png" alt="M√°y h√∫t d·ªãch" class="category-icon">M√°y h√∫t d·ªãch</div>
                                        <div class="brand-item" data-category="M√°y massage"><img src="icon-hinhdanhmuc/nhom-massage.png" alt="M√°y massage" class="category-icon">M√°y massage</div>
                                        <div class="brand-item" data-category="Thi·∫øt b·ªã t·∫≠p"><img src="icon-hinhdanhmuc/nhom-maytap.png" alt="Thi·∫øt b·ªã t·∫≠p" class="category-icon">Thi·∫øt b·ªã t·∫≠p</div>
                                        <div class="brand-item" data-category="N·ªám"><img src="icon-hinhdanhmuc/nhom-nem.png" alt="N·ªám" class="category-icon">N·ªám</div>
                                        <div class="brand-item" data-category="D·ª•ng c·ª• h·ªó tr·ª£"><img src="icon-hinhdanhmuc/nhom-dungcuhotro.png" alt="D·ª•ng c·ª• h·ªó tr·ª£" class="category-icon">D·ª•ng c·ª• h·ªó tr·ª£</div>
                                        <div class="brand-item" data-category="Thi·∫øt b·ªã y t·∫ø kh√°c"><img src="icon-hinhdanhmuc/nhom-thietbiyte.png" alt="Thi·∫øt b·ªã y t·∫ø kh√°c" class="category-icon">Thi·∫øt b·ªã y t·∫ø kh√°c</div>
                                    </div>

                                    <div class="category-main">
                                        <div class="category-detail" id="categoryDetail">
                                            <p>Di chu·ªôt v√†o c√°c nh√≥m s·∫£n ph·∫©m ·ªü tr√™n ƒë·ªÉ xem chi ti·∫øt</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <a href="thong-tin.html">Gi·ªõi thi·ªáu</a>
                        <a href="tin-tuc.html">Tin t·ª©c - Ki·∫øn th·ª©c</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

<div class="page" id="productListPage">
    <aside id="filterPanel" class="filter-panel" aria-label="B·ªô l·ªçc s·∫£n ph·∫©m">
        <div class="filter-header">
            <h3>B·ªô l·ªçc</h3>
            <button class="filter-close" aria-label="ƒê√≥ng b·ªô l·ªçc">√ó</button>
        </div>

        <div class="filter-block" id="groupFilterBlock">
            <h4>Nh√≥m s·∫£n ph·∫©m</h4>
            <div class="filter-options" id="groupOptions"></div>
            <button id="groupMore" class="btn btn-outline" style="margin-top:8px; display:none;">Xem th√™m</button>
        </div>

        <div class="filter-block">
            <h4>M·ª©c gi√°</h4>
            <div class="filter-options" id="priceOptions"></div>
        </div>

        <div class="filter-block">
            <h4>Ho·∫∑c nh·∫≠p kho·∫£ng gi√° ph√π h·ª£p v·ªõi b·∫°n:</h4>
            <div class="price-inputs">
                <input id="minPrice" type="text" placeholder="390.000ƒë">
                <input id="maxPrice" type="text" placeholder="63.990.000ƒë">
            </div>
        </div>

        <div class="filter-block" style="margin-bottom:0; border-bottom:none;">
            <div class="filter-actions">
                <button id="applyFilters" class="btn btn-primary">√Åp d·ª•ng b·ªô l·ªçc</button>
                <button id="resetFilters" class="btn btn-outline">ƒê·∫∑t l·∫°i</button>
            </div>
        </div>
    </aside>

    <div class="filter-overlay" id="filterOverlay"></div>

    <section class="content-area">
        <div class="content-header">
            <div class="result-count" id="resultCount">K·∫øt qu·∫£ t√¨m ki·∫øm: 0 s·∫£n ph·∫©m</div>
            <select id="sortSelect" class="sort-select">
                <option value="default">M·∫∑c ƒë·ªãnh</option>
                <option value="price-asc">Gi√° th·∫•p ƒë·∫øn cao</option>
                <option value="price-desc">Gi√° cao ƒë·∫øn th·∫•p</option>
                <option value="newest">M·ªõi nh·∫•t</option>
            </select>
            <button id="mobileFilterToggle" class="mobile-filter-toggle">B·ªô l·ªçc</button>
        </div>

        <div id="typePanel" class="type-panel" style="display:none;">
            <h3>Lo·∫°i s·∫£n ph·∫©m</h3>
            <div id="typeGrid" class="type-grid"></div>
        </div>

        <div id="productGrid" class="product-grid"></div>
<div id="cartSidebar" class="cart-sidebar" style="width:320px; background:#fff; border:1px solid var(--border); border-radius:12px; box-shadow:0 4px 16px rgba(0,0,0,0.04); padding:16px; margin-left:16px; min-height:380px; display:none;">
    <h3>Gi·ªè h√†ng c·ªßa b·∫°n</h3>
    <div id="cartList"></div>
</div>

        <div id="pagination" class="pagination"></div>
    </section>
</div>

<!-- Product Detail View (Hidden by default) -->
<div id="productDetailView" class="product-detail-view" style="max-width: 1200px; margin: 20px auto;">
    <button class="back-to-list" onclick="backToProductList()">‚Üê Quay l·∫°i danh s√°ch</button>
    <div id="productDetailContent">
        <div class="product-loading">ƒêang t·∫£i...</div>
    </div>
</div>

<script>
(async function(){
    const categoryData = {
        "Gi∆∞·ªùng": ["Gi∆∞·ªùng b·ªánh c∆° b·∫£n", "Gi∆∞·ªùng chuy√™n d·ª•ng (ICU, s·∫£n khoa)", "Gi∆∞·ªùng ƒëi·ªÅu ch·ªânh ƒë·ªô cao/ t∆∞ th·∫ø (gi∆∞·ªùng ƒëi·ªán)", "Gi∆∞·ªùng chƒÉm s√≥c t·∫°i nh√†"],
        "Xe lƒÉn": ["Xe lƒÉn tay (ng∆∞·ªùi d√πng t·ª± ƒë·∫©y)", "Xe lƒÉn ƒë·∫©y sau (ng∆∞·ªùi chƒÉm s√≥c ƒë·∫©y)", "Xe lƒÉn ƒëi·ªán", "Xe lƒÉn th·ªÉ thao", "Xe lƒÉn g·∫•p g·ªçn/ di chuy·ªÉn", "Xe lƒÉn l√™n xu·ªëng c·∫ßu thang"],
        "Xe Scooter ƒëi·ªán": ["Lo·∫°i di chuy·ªÉn trong nh√†/ ƒë∆∞·ªùng b·∫±ng ph·∫≥ng", "Lo·∫°i ƒë·ªãa h√¨nh (b√°nh l·ªõn, ƒëi ƒë∆∞·ªùng d√†i)", "Lo·∫°i g·∫•p g·ªçn/ th√°o r·ªùi"],
        "BƒÉng ca": ["BƒÉng ca c·∫•p c·ª©u (c·ªë ƒë·ªãnh)", "BƒÉng ca ƒë·∫©y (c√≥ b√°nh xe)", "BƒÉng ca g·∫•p (v·∫≠n chuy·ªÉn)", "BƒÉng ca chuy√™n d·ª•ng (ch·ªëng s·ªëc, ch·ª•p X-Quang)", "ƒê·ªám v·∫≠n chuy·ªÉn"],
        "T·ªß": ["T·ªß ƒë·ª±ng thu·ªëc", "T·ªß ƒë·ª±ng h·ªì s∆° b·ªánh √°n", "T·ªß tr∆∞ng b√†y/ l∆∞u tr·ªØ d·ª•ng c·ª•", "T·ªß ƒë·∫ßu gi∆∞·ªùng b·ªánh"],
        "M√°y t·∫°o oxy": ["M√°y t·∫°o oxy t·∫°i nh√† (lo·∫°i l·ªõn)", "M√°y t·∫°o oxy x√°ch tay/ di ƒë·ªông", "M√°y t·∫°o oxy d√≤ng cao (cho tr·ªã li·ªáu ƒë·∫∑c bi·ªát)"],
        "M√°y ƒëo": ["M√°y ƒëo huy·∫øt √°p", "M√°y ƒëo ƒë∆∞·ªùng huy·∫øt", "M√°y ƒëo n·ªìng ƒë·ªô oxy trong m√°u (SpO2)", "M√°y ƒëo th√¢n nhi·ªát", "M√°y ƒëo tim (ECG di ƒë·ªông)", "C√¢n s·ª©c kh·ªèe (c∆°/ ƒëi·ªán t·ª≠)"],
        "M√°y x√¥ng": ["M√°y x√¥ng kh√≠ dung ki·ªÉu n√©n", "M√°y x√¥ng si√™u √¢m", "M√°y x√¥ng m√†ng (mesh)"],
        "M√°y h√∫t d·ªãch": ["M√°y h√∫t d·ªãch ƒë·ªÉ b√†n/ c·ªë ƒë·ªãnh", "M√°y h√∫t d·ªãch x√°ch tay/ di ƒë·ªông"],
        "M√°y massage": ["M√°y massage c·∫ßm tay (gi·∫£m ƒëau c∆°)", "ƒêai/ gh·∫ø massage to√†n th√¢n", "M√°y massage ch√¢n (xoa b√≥p, l∆∞u th√¥ng m√°u)", "Thi·∫øt b·ªã massage tr·ªã li·ªáu"],
        "Thi·∫øt b·ªã t·∫≠p": ["Thi·∫øt b·ªã t·∫≠p v·∫≠n ƒë·ªông th·ª• ƒë·ªông (CPM)", "Thi·∫øt b·ªã t·∫≠p ƒëi/ thƒÉng b·∫±ng", "Thi·∫øt b·ªã t·∫≠p ph·ª•c h·ªìi ch·ª©c nƒÉng tay/ ch√¢n", "M√°y t·∫≠p th·ªÉ d·ª•c chuy√™n bi·ªát", "D·ª•ng c·ª• t·∫≠p tr·ªã li·ªáu"],
        "N·ªám": ["N·ªám ch·ªëng lo√©t (h∆°i, x·ªëp, gel)", "N·ªám b·ªánh vi·ªán ti√™u chu·∫©n", "N·ªám n√¢ng ƒë·ª° c∆° th·ªÉ"],
        "D·ª•ng c·ª• h·ªó tr·ª£": ["H·ªó tr·ª£ di chuy·ªÉn", "H·ªó tr·ª£ v·ªá sinh", "H·ªó tr·ª£ t·∫Øm", "H·ªó tr·ª£ m·∫∑c qu·∫ßn √°o", "H·ªó tr·ª£ ƒÉn u·ªëng"],
        "Thi·∫øt b·ªã y t·∫ø kh√°c": ["ƒê√®n kh√°m b·ªánh", "M√°y kh·ª≠ rung tim (AED)", "B∆°m ti√™m ƒëi·ªán", "H·ªôp ƒë·ª±ng d·ª•ng c·ª• v√¥ tr√πng"]
    };
    window.categoryData = categoryData;

    // Placeholder data; add your product list here.
    let sampleProducts = [];

    // Function to remove Vietnamese tones for search
    function removeVietnameseTones(str) {
        if (!str) return '';
        str = str.toLowerCase();
        str = str.replace(/√†|√°|·∫°|·∫£|√£|√¢|·∫ß|·∫•|·∫≠|·∫©|·∫´|ƒÉ|·∫±|·∫Ø|·∫∑|·∫≥|·∫µ/g, 'a');
        str = str.replace(/√®|√©|·∫π|·∫ª|·∫Ω|√™|·ªÅ|·∫ø|·ªá|·ªÉ|·ªÖ/g, 'e');
        str = str.replace(/√¨|√≠|·ªã|·ªâ|ƒ©/g, 'i');
        str = str.replace(/√≤|√≥|·ªç|·ªè|√µ|√¥|·ªì|·ªë|·ªô|·ªï|·ªó|∆°|·ªù|·ªõ|·ª£|·ªü|·ª°/g, 'o');
        str = str.replace(/√π|√∫|·ª•|·ªß|≈©|∆∞|·ª´|·ª©|·ª±|·ª≠|·ªØ/g, 'u');
        str = str.replace(/·ª≥|√Ω|·ªµ|·ª∑|·ªπ/g, 'y');
        str = str.replace(/ƒë/g, 'd');
        return str;
    }

    async function loadProductsFromApi(){
        try {
            renderSkeleton(Math.min(state.pageSize, 6));
            const res = await fetch('api/admin_product_list.php');
            if (!res.ok) {
                throw new Error('HTTP ' + res.status + ' khi g·ªçi api/admin_product_list.php');
            }
            const out = await res.json();
            if (!out.success) throw new Error((out.error || 'API error') + (out.detail ? ' - ' + out.detail : ''));
            if (!out.data || !out.data.length) {
                productGridEl.innerHTML = '<div style="padding:20px; text-align:center; color:#b45309;">API tr·∫£ v·ªÅ 0 s·∫£n ph·∫©m.</div>';
                return;
            }
            // Helper to infer group from type if API doesn't return group_name
            function inferGroupFromType(typeName){
                const t = (typeName || '').trim();
                if (!t) return '';
                const groups = Object.keys(categoryData || {});
                for (const g of groups) {
                    const types = categoryData[g] || [];
                    if (types.includes(t)) return g;
                }
                return '';
            }

            sampleProducts = (out.data || []).map(p => ({
                id: p.id,
                name: p.name,
                sku: p.sku,
                price: Number(p.sale_price || p.original_price || 0),
                sale_price: p.sale_price,
                original_price: p.original_price,
                thumbnail_path: p.thumbnail_path,
                slug: p.slug,
                group: p.group || p.group_name || inferGroupFromType(p.type || p.type_name) || '',
                type: p.type || p.type_name || ''
            }));
            
            console.log('Loaded products:', sampleProducts.length);
            console.log('First 5 products:', sampleProducts.slice(0, 5).map(p => ({ id: p.id, name: p.name, group: p.group, type: p.type })));
            
            // Build categoryData from actual products
            const newCategoryData = {};
            sampleProducts.forEach(p => {
                if (p.group) {
                    if (!newCategoryData[p.group]) {
                        newCategoryData[p.group] = [];
                    }
                    if (p.type && !newCategoryData[p.group].includes(p.type)) {
                        newCategoryData[p.group].push(p.type);
                    }
                }
            });
            // Merge with existing categoryData
            Object.assign(categoryData, newCategoryData);
            
            // Re-render group filters after loading data to ensure all groups are available
            renderGroupFilters();
            applyStateToControls(); // Re-apply state to ensure checkboxes are checked correctly
            
            scheduleRender();
        } catch (err) {
            productGridEl.innerHTML = `<div style="padding:20px; text-align:center; color:#b91c1c;">Kh√¥ng t·∫£i ƒë∆∞·ª£c danh s√°ch s·∫£n ph·∫©m t·ª´ server. ${err.message || ''}</div>`;
            console.error(err);
        }
    }

    const priceRanges = [
        { id: "all", label: "T·∫•t c·∫£", test: () => true },
        { id: "lt2", label: "D∆∞·ªõi 2 tri·ªáu", test: p => p < 2000000 },
        { id: "2to4", label: "T·ª´ 2 - 4 tri·ªáu", test: p => p >= 2000000 && p < 4000000 },
        { id: "4to7", label: "T·ª´ 4 - 7 tri·ªáu", test: p => p >= 4000000 && p < 7000000 },
        { id: "7to13", label: "T·ª´ 7 - 13 tri·ªáu", test: p => p >= 7000000 && p < 13000000 },
        { id: "13to20", label: "T·ª´ 13 - 20 tri·ªáu", test: p => p >= 13000000 && p < 20000000 },
        { id: "gt20", label: "Tr√™n 20 tri·ªáu", test: p => p >= 20000000 }
    ];

    const state = {
        groups: [],
        types: [],
        priceRange: "all",
        min: "",
        max: "",
        sort: "default",
        page: 1,
        pageSize: 9,
        showGroupLimit: 14,
        searchQuery: ""
    };

    const groupOptionsEl = document.getElementById("groupOptions");
    const priceOptionsEl = document.getElementById("priceOptions");
    const resultCountEl = document.getElementById("resultCount");
    const productGridEl = document.getElementById("productGrid");
    const paginationEl = document.getElementById("pagination");
    const typePanelEl = document.getElementById("typePanel");
    const typeGridEl = document.getElementById("typeGrid");
    const minPriceEl = document.getElementById("minPrice");
    const maxPriceEl = document.getElementById("maxPrice");
    const sortSelect = document.getElementById("sortSelect");
    const filterPanel = document.getElementById("filterPanel");
    const filterOverlay = document.getElementById("filterOverlay");
    const mobileToggle = document.getElementById("mobileFilterToggle");
    const filterCloseBtn = document.querySelector(".filter-close");
    const groupMoreBtn = document.getElementById("groupMore");

    function formatCurrency(val){
        if (!Number.isFinite(val)) return "-";
        return val.toLocaleString('vi-VN', { style: 'currency', currency: 'VND', maximumFractionDigits: 0 });
    }

    function parseCurrency(str){
        if (!str) return "";
        return parseInt(String(str).replace(/[^0-9]/g, ""), 10) || "";
    }

    function renderPriceOptions(){
        priceRanges.forEach(range => {
            const label = document.createElement('label');
            label.className = 'filter-option';
            label.innerHTML = `<input type="radio" name="priceRange" value="${range.id}"> ${range.label}`;
            priceOptionsEl.appendChild(label);
        });
        priceOptionsEl.querySelector('input[value="all"]').checked = true;
        priceOptionsEl.addEventListener('change', (e)=>{
            if (e.target.name === 'priceRange') {
                state.priceRange = e.target.value;
                state.page = 1;
                syncUrl();
                scheduleRender();
            }
        });
    }

    function renderGroupFilters(){
        const groups = Object.keys(categoryData);
        groupOptionsEl.innerHTML = '';
        groups.slice(0, state.showGroupLimit).forEach(g => {
            const label = document.createElement('label');
            label.className = 'filter-option';
            label.innerHTML = `<input type="checkbox" value="${g}"> ${g}`;
            groupOptionsEl.appendChild(label);
        });
        groupMoreBtn.style.display = groups.length > state.showGroupLimit ? 'inline-block' : 'none';

        groupOptionsEl.onchange = (e)=>{
            if (e.target.type === 'checkbox') {
                const val = e.target.value;
                if (e.target.checked) { state.groups.push(val); }
                else { state.groups = state.groups.filter(g => g !== val); }
                state.types = [];
                state.page = 1;
                syncUrl();
                scheduleRender();
            }
        };

        groupMoreBtn.onclick = ()=>{
            state.showGroupLimit = groups.length;
            renderGroupFilters();
        };
    }

    function renderTypeGrid(filtered){
        if (!state.groups.length) {
            typePanelEl.style.display = 'none';
            typeGridEl.innerHTML = '';
            return;
        }

        // L·∫•y danh s√°ch lo·∫°i theo c√°c nh√≥m ƒëang ch·ªçn t·ª´ categoryData
        let groupTypes = [];
        state.groups.forEach(g => {
            const types = (categoryData[g] || []);
            types.forEach(t => {
                if (t && !groupTypes.includes(t)) {
                    groupTypes.push(t);
                }
            });
        });

        const baseList = filterList(false); // danh s√°ch s·∫£n ph·∫©m sau khi √°p d·ª•ng nh√≥m / t√¨m ki·∫øm / gi√° (kh√¥ng √°p d·ª•ng lo·∫°i)

        // N·∫øu categoryData kh√¥ng c√≥ c·∫•u h√¨nh cho nh√≥m hi·ªán t·∫°i, fallback l·∫•y t·ª´ d·ªØ li·ªáu th·ª±c t·∫ø
        if (!groupTypes.length) {
            groupTypes = Array.from(new Set(baseList.map(p => p.type).filter(Boolean)));
        }

        if (state.types.length) {
            state.types = state.types.filter(t => groupTypes.includes(t));
        }

        const counts = groupTypes.reduce((acc, t)=>{
            acc[t] = baseList.filter(p=> p.type === t).length;
            return acc;
        }, {});

        typePanelEl.style.display = groupTypes.length ? 'block' : 'none';
        typeGridEl.innerHTML = '';

        // "T·∫•t c·∫£" card
        const allCard = document.createElement('div');
        const allActive = state.types.length === 0;
        allCard.className = 'type-card' + (allActive ? ' active' : '');
        allCard.innerHTML = `<div>T·∫•t c·∫£</div><span>${baseList.length} sp</span>`;
        allCard.addEventListener('click', () => {
            state.types = [];
            state.page = 1;
            syncUrl();
            scheduleRender();
        });
        typeGridEl.appendChild(allCard);

        groupTypes.forEach(t => {
            const card = document.createElement('div');
            const isActive = state.types.includes(t);
            card.className = 'type-card' + (isActive ? ' active' : '');
            card.innerHTML = `<div>${t}</div><span>${counts[t] || 0} sp</span>`;
            card.addEventListener('click', () => {
                if (isActive) {
                    state.types = state.types.filter(x => x !== t);
                } else {
                    state.types.push(t);
                }
                state.page = 1;
                syncUrl();
                scheduleRender();
            });
            typeGridEl.appendChild(card);
        });
    }

    function renderProducts(list){
        productGridEl.innerHTML = '';
        if (!list.length) {
            const empty = document.createElement('div');
            empty.className = 'product-card';
            empty.style.display = 'flex';
            empty.style.alignItems = 'center';
            empty.style.justifyContent = 'center';
            empty.style.color = 'var(--muted)';
            empty.textContent = 'Ch∆∞a c√≥ s·∫£n ph·∫©m kh·ªõp b·ªô l·ªçc. Th·ª≠ ƒë·∫∑t l·∫°i b·ªô l·ªçc.';
            productGridEl.appendChild(empty);
            return;
        }

        list.forEach(p => {
            const card = document.createElement('div');
            card.className = 'product-card';
            const imgSrc = p.thumbnail_path || p.image || 'https://via.placeholder.com/300x200?text=Product';
            const priceVal = Number.isFinite(p.sale_price) ? p.sale_price : (Number.isFinite(p.price) ? p.price : (Number.isFinite(p.original_price) ? p.original_price : 0));
            const originalVal = Number.isFinite(p.original_price) ? p.original_price : 0;
            const buyLabel = priceVal && priceVal > 0 ? 'üõí Mua ngay' : 'üìû Li√™n h·ªá';
            const showOriginal = originalVal && priceVal && originalVal > priceVal;
            
            // Generate random rating (same as index.html)
            const rating = (Math.random() * 2 + 3).toFixed(1); // 3.0 - 5.0
            const reviews = Math.floor(Math.random() * 500) + 10; // 10-510 reviews
            const ratingNum = parseFloat(rating);
            const fullStars = Math.floor(ratingNum);
            const hasHalfStar = ratingNum % 1 >= 0.5;
            const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
            
            let starsHTML = '';
            for (let i = 0; i < fullStars; i++) {
                starsHTML += '<span style="color: #f59e0b;">‚òÖ</span>';
            }
            if (hasHalfStar) {
                starsHTML += '<span style="color: #f59e0b;">‚òÖ</span>';
            }
            for (let i = 0; i < emptyStars; i++) {
                starsHTML += '<span style="color: #e5e7eb;">‚òÖ</span>';
            }
            
            const priceHtml = `
                <div class="product-price">${priceVal ? formatCurrency(priceVal) : 'ƒêang c·∫≠p nh·∫≠t'}</div>
                ${showOriginal ? `<div class="product-price-original" style="color: var(--muted); text-decoration: line-through; font-size: 13px;">${formatCurrency(originalVal)}</div>` : ''}
            `;
            card.innerHTML = `
                <img src="${imgSrc}" alt="${p.name || ''}">
                <div class="product-name">${p.name || 'T√™n s·∫£n ph·∫©m'}</div>
                ${priceHtml}
                <div class="product-rating" style="color: #f59e0b; font-size: 13px; margin-top: 4px;">
                    ${starsHTML} <span style="color: #6b7280; font-size: 12px;">(${reviews})</span>
                </div>
                <div class="product-actions">
                    <button class="btn btn-outline" data-product-id="${p.id}">Xem chi ti·∫øt</button>
                    ${priceVal && priceVal > 0
                        ? `<button class='btn btn-primary add-to-cart-btn' data-product-id='${p.id}'>üõí Mua ngay</button>`
                        : `<a class='btn btn-primary' href='tel:0938062808' style='display:inline-block;text-decoration:none;'>üìû Li√™n h·ªá</a>`}
                </div>
            `;
            productGridEl.appendChild(card);
        });

        // G√°n s·ª± ki·ªán cho n√∫t th√™m v√†o gi·ªè h√†ng
        const cartBtns = document.querySelectorAll('.add-to-cart-btn');
        cartBtns.forEach(btn => {
            btn.addEventListener('click', function(e) {
                if (!window.isLoggedIn) {
                    if (typeof toggleLoginForm === 'function') toggleLoginForm();
                    else alert('B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ th√™m v√†o gi·ªè h√†ng!');
                    return;
                }
                const id = this.getAttribute('data-product-id');
                const product = list.find(p => String(p.id) === String(id));
                if (!product) return;
                // L·∫•y gi·ªè h√†ng hi·ªán t·∫°i
                let cart = [];
                try { cart = JSON.parse(localStorage.getItem('cartItems')) || []; } catch(e) { cart = []; }
                // Ki·ªÉm tra ƒë√£ c√≥ s·∫£n ph·∫©m ch∆∞a
                const exist = cart.find(item => String(item.id) === String(product.id));
                if (exist) {
                    exist.qty = (exist.qty || 1) + 1;
                } else {
                    cart.push({
                        id: product.id,
                        name: product.name,
                        price: product.sale_price || product.price || product.original_price || 0,
                        image: product.thumbnail_path || product.image || '',
                        qty: 1
                    });
                }
                localStorage.setItem('cartItems', JSON.stringify(cart));
                window.renderCartSidebar && window.renderCartSidebar();
                alert('ƒê√£ th√™m v√†o gi·ªè h√†ng!');
            });
        });
        function renderCartSidebar() {
            var cartSidebar = document.getElementById('cartSidebar');
            var cartList = document.getElementById('cartList');
            let cart = [];
            try { cart = JSON.parse(localStorage.getItem('cartItems')) || []; } catch(e) { cart = []; }
            if (!cart.length) {
                cartSidebar.style.display = 'none';
                cartList.innerHTML = '';
                return;
            }
            cartSidebar.style.display = 'block';
            cartList.innerHTML = cart.map(item => `
                <div style='display:flex;align-items:center;gap:10px;margin-bottom:12px;'>
                    <img src='${item.image}' alt='' style='width:60px;height:60px;object-fit:cover;border-radius:8px;border:1px solid #eee;'>
                    <div style='flex:1;'>
                        <div style='font-weight:600;'>${item.name}</div>
                        <div style='color:#059669;'>${item.price ? item.price.toLocaleString('vi-VN') + '‚Ç´' : 'ƒêang c·∫≠p nh·∫≠t'}</div>
                        <div style='font-size:13px;color:#666;'>S·ªë l∆∞·ª£ng: ${item.qty}</div>
                    </div>
                </div>
            `).join('');
        }
        document.addEventListener('DOMContentLoaded', function() {
            renderCartSidebar();
        });

    function renderSkeleton(count){
        productGridEl.innerHTML = '';
        for (let i=0; i<count; i++){
            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `
                <div class="skeleton" style="height:150px;"></div>
                <div class="skeleton" style="height:16px; width:80%;"></div>
                <div class="skeleton" style="height:16px; width:50%;"></div>
                <div class="skeleton" style="height:14px; width:40%;"></div>
                <div style="display:flex; gap:8px;">
                    <div class="skeleton" style="height:38px; flex:1;"></div>
                    <div class="skeleton" style="height:38px; flex:1;"></div>
                </div>
            `;
            productGridEl.appendChild(card);
        }
    }

    function renderPagination(total){
        const totalPages = Math.max(1, Math.ceil(total / state.pageSize));
        state.page = Math.min(state.page, totalPages);
        paginationEl.innerHTML = '';
        const prev = document.createElement('button');
        prev.className = 'page-btn';
        prev.textContent = 'Prev';
        prev.disabled = state.page === 1;
        prev.onclick = () => { state.page--; syncUrl(); scheduleRender(); };
        paginationEl.appendChild(prev);

        for (let i=1; i<=totalPages; i++){
            const btn = document.createElement('button');
            btn.className = 'page-btn' + (i===state.page ? ' active' : '');
            btn.textContent = i;
            btn.onclick = ()=>{ state.page = i; syncUrl(); scheduleRender(); };
            paginationEl.appendChild(btn);
        }

        const next = document.createElement('button');
        next.className = 'page-btn';
        next.textContent = 'Next';
        next.disabled = state.page === totalPages;
        next.onclick = () => { state.page++; syncUrl(); scheduleRender(); };
        paginationEl.appendChild(next);
    }

    function applyFilters(){
        const min = parseCurrency(minPriceEl.value);
        const max = parseCurrency(maxPriceEl.value);
        state.min = min === "" ? "" : min;
        state.max = max === "" ? "" : max;
        state.page = 1;
        syncUrl();
        scheduleRender();
    }

    function resetFilters(){
        state.groups = [];
        state.types = [];
        state.priceRange = 'all';
        state.min = '';
        state.max = '';
        state.sort = 'default';
        state.page = 1;
        state.showGroupLimit = 14;
        state.searchQuery = '';
        minPriceEl.value = '';
        maxPriceEl.value = '';
        sortSelect.value = 'default';
        const searchInput = document.querySelector('.search-input');
        if (searchInput) searchInput.value = '';
        syncUrl();
        renderGroupFilters();
        renderPriceOptions();
        scheduleRender();
    }

    const normalize = (str) => removeVietnameseTones((str || '').trim()).toLowerCase();

    function filterList(includeTypes = true){
        let list = sampleProducts.slice();
        const originalTotal = list.length;

        // Debug: Log state (ch·ªâ ƒë·ªÉ h·ªó tr·ª£ ki·ªÉm tra n·∫øu c·∫ßn)
        console.log('filterList state:', {
            searchQuery: state.searchQuery,
            groups: state.groups,
            types: state.types,
            priceRange: state.priceRange,
            totalProducts: originalTotal
        });

        // Search filter
        if (state.searchQuery) {
            const searchTerm = normalize(state.searchQuery);
            list = list.filter(p => {
                const name = normalize(p.name);
                const sku = normalize(p.sku);
                return name.includes(searchTerm) || sku.includes(searchTerm);
            });
        }

        if (state.groups.length) {
            const targetGroups = state.groups.map(normalize);
            list = list.filter(p => {
                const gName = normalize(p.group || '');
                if (!gName) return false;
                // Cho ph√©p kh·ªõp linh ho·∫°t: ch·ª©a nhau theo t·ª´ kh√≥a, tr√°nh t√¨nh tr·∫°ng "Gi∆∞·ªùng" vs "Gi∆∞·ªùng b·ªánh nh√¢n" kh√¥ng kh·ªõp
                return targetGroups.some(tg => gName.includes(tg) || tg.includes(gName));
            });
        }

        if (includeTypes && state.types.length) {
            const targetTypes = state.types.map(normalize);
            list = list.filter(p => targetTypes.includes(normalize(p.type)));
        }

        const selectedRange = priceRanges.find(r => r.id === state.priceRange) || priceRanges[0];
        list = list.filter(p => selectedRange.test(p.price));
        if (state.min !== '') list = list.filter(p => p.price >= state.min);
        if (state.max !== '') list = list.filter(p => p.price <= state.max);

        switch(state.sort){
            case 'price-asc': list.sort((a,b)=>a.price-b.price); break;
            case 'price-desc': list.sort((a,b)=>b.price-a.price); break;
            case 'newest': list.sort((a,b)=>b.id-a.id); break;
            default: break;
        }

        // Fallback an to√†n: n·∫øu sau khi √°p d·ª•ng nh√≥m/lo·∫°i m√† ra 0 sp nh∆∞ng API th·ª±c t·∫ø c√≥ d·ªØ li·ªáu,
        // v√† ng∆∞·ªùi d√πng KH√îNG nh·∫≠p t√¨m ki·∫øm/gi√°, th√¨ hi·ªÉn th·ªã l·∫°i to√†n b·ªô danh s√°ch ƒë·ªÉ tr√°nh tr·∫Øng tr∆°n.
        if (!state.searchQuery && state.priceRange === 'all' && state.min === '' && state.max === ''
            && (state.groups.length || state.types.length) && originalTotal > 0 && list.length === 0) {
            console.warn('Filters resulted in 0 products, fallback to show all products.');
            list = sampleProducts.slice();
        }

        return list;
    }

    let renderTimer = null;
    function scheduleRender(){
        if (renderTimer) clearTimeout(renderTimer);
        renderSkeleton(Math.min(state.pageSize, 6));
        renderTimer = setTimeout(render, 450);
    }

    function render(){
        const filtered = filterList(true);
        const searchText = state.searchQuery ? ` cho "${state.searchQuery}"` : '';
        resultCountEl.textContent = `K·∫øt qu·∫£ t√¨m ki·∫øm${searchText}: ${filtered.length} s·∫£n ph·∫©m`;
        renderTypeGrid(filtered);

        const start = (state.page -1) * state.pageSize;
        const pageItems = filtered.slice(start, start + state.pageSize);
        renderProducts(pageItems);
        renderPagination(filtered.length);
    }

    function syncUrl(){
        const params = new URLSearchParams();
        if (state.groups.length) params.set('groups', state.groups.join(','));
        if (state.types.length) params.set('types', state.types.join(','));
        if (state.priceRange && state.priceRange !== 'all') params.set('range', state.priceRange);
        if (state.min !== '') params.set('min', state.min);
        if (state.max !== '') params.set('max', state.max);
        if (state.sort && state.sort !== 'default') params.set('sort', state.sort);
        if (state.page > 1) params.set('page', state.page);
        const qs = params.toString();
        const newUrl = qs ? `${location.pathname}?${qs}` : location.pathname;
        window.history.replaceState({}, '', newUrl);
    }

    function restoreFromUrl(){
        const params = new URLSearchParams(window.location.search);
        const groups = (params.get('groups')||'').split(',').filter(Boolean);
        const types = (params.get('types')||'').split(',').filter(Boolean);
        const range = params.get('range') || 'all';
        const min = params.get('min') ? parseInt(params.get('min'),10) : '';
        const max = params.get('max') ? parseInt(params.get('max'),10) : '';
        const sort = params.get('sort') || 'default';
        const page = params.get('page') ? parseInt(params.get('page'),10) : 1;
        const searchQuery = params.get('search') || '';

        state.groups = groups;
        state.types = types;
        state.priceRange = range;
        state.min = Number.isFinite(min) ? min : '';
        state.max = Number.isFinite(max) ? max : '';
        state.sort = sort;
        state.page = Number.isFinite(page) ? page : 1;
        state.searchQuery = searchQuery;
        
        // Set search input value from URL
        const searchInput = document.querySelector('.search-input');
        if (searchInput && searchQuery) {
            searchInput.value = searchQuery;
        }
    }

    function bindInputs(){
        document.getElementById('applyFilters').onclick = applyFilters;
        document.getElementById('resetFilters').onclick = resetFilters;
        sortSelect.onchange = () => { state.sort = sortSelect.value; state.page = 1; syncUrl(); scheduleRender(); };
        
        // Search functionality with suggestions
        const searchInput = document.querySelector('.search-input');
        const searchBtn = document.querySelector('.search-btn');
        const suggestionsBox = document.getElementById('searchSuggestions');
        let suggestionTimer = null;
        
        function showSuggestions(query) {
            if (!query || query.length < 1) {
                suggestionsBox.classList.remove('show');
                suggestionsBox.innerHTML = '';
                return;
            }
            
            const searchTerm = removeVietnameseTones(query);
            const matches = sampleProducts.filter(p => {
                const name = removeVietnameseTones(p.name || '');
                const sku = removeVietnameseTones(p.sku || '');
                return name.includes(searchTerm) || sku.includes(searchTerm);
            }).slice(0, 8); // Limit to 8 suggestions
            
            if (matches.length === 0) {
                suggestionsBox.innerHTML = '<div class="suggestion-empty">Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m ph√π h·ª£p</div>';
                suggestionsBox.classList.add('show');
                return;
            }
            
            suggestionsBox.innerHTML = matches.map(p => {
                const imgSrc = p.thumbnail_path || 'https://via.placeholder.com/50x50?text=SP';
                const priceVal = Number.isFinite(p.sale_price) ? p.sale_price : (Number.isFinite(p.price) ? p.price : (Number.isFinite(p.original_price) ? p.original_price : 0));
                const priceText = priceVal ? formatCurrency(priceVal) : 'ƒêang c·∫≠p nh·∫≠t';
                
                // Highlight matching text
                const nameHighlighted = highlightText(p.name || '', query);
                
                return `
                    <div class="suggestion-item" data-product-id="${p.id}" data-product-slug="${p.slug || ''}">
                        <img src="${imgSrc}" alt="${p.name}" class="suggestion-img" onerror="this.src='https://via.placeholder.com/50x50?text=SP'">
                        <div class="suggestion-info">
                            <div class="suggestion-name">${nameHighlighted}</div>
                            <div class="suggestion-sku">SKU: ${p.sku || 'N/A'}</div>
                        </div>
                        <div class="suggestion-price">${priceText}</div>
                    </div>
                `;
            }).join('');
            
            suggestionsBox.classList.add('show');
            
            // Add click handlers to suggestions
            suggestionsBox.querySelectorAll('.suggestion-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    const productId = item.dataset.productId;
                    const productSlug = item.dataset.productSlug;
                    const url = productSlug ? `san-pham/${productSlug}-${productId}` : `san-pham.php?id=${productId}`;
                    window.location.href = url;
                });
            });
        }
        
        function highlightText(text, query) {
            if (!text || !query) return text;
            const searchTerm = removeVietnameseTones(query);
            const textNormalized = removeVietnameseTones(text);
            const index = textNormalized.indexOf(searchTerm);
            
            if (index === -1) return text;
            
            // Find the original position in the text with diacritics
            let count = 0;
            let startPos = 0;
            for (let i = 0; i < text.length; i++) {
                if (removeVietnameseTones(text[i]) === textNormalized[count]) {
                    if (count === index) {
                        startPos = i;
                        break;
                    }
                    count++;
                }
            }
            
            const before = text.substring(0, startPos);
            const match = text.substring(startPos, startPos + query.length);
            const after = text.substring(startPos + query.length);
            
            return `${before}<span class="suggestion-highlight">${match}</span>${after}`;
        }
        
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.trim();
                
                // Show suggestions
                if (suggestionTimer) clearTimeout(suggestionTimer);
                suggestionTimer = setTimeout(() => {
                    showSuggestions(query);
                }, 200);
                
                // Update search state
                state.searchQuery = query;
                state.page = 1;
                scheduleRender();
            });
            
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    suggestionsBox.classList.remove('show');
                    state.searchQuery = e.target.value.trim();
                    state.page = 1;
                    scheduleRender();
                }
            });
            
            searchInput.addEventListener('focus', (e) => {
                if (e.target.value.trim()) {
                    showSuggestions(e.target.value.trim());
                }
            });
        }
        
        if (searchBtn) {
            searchBtn.addEventListener('click', () => {
                if (searchInput) {
                    suggestionsBox.classList.remove('show');
                    state.searchQuery = searchInput.value.trim();
                    state.page = 1;
                    scheduleRender();
                }
            });
        }
        
        // Close suggestions when clicking outside
        document.addEventListener('click', (e) => {
            if (!searchInput?.contains(e.target) && !suggestionsBox?.contains(e.target) && !searchBtn?.contains(e.target)) {
                suggestionsBox?.classList.remove('show');
            }
        });
        
        [minPriceEl, maxPriceEl].forEach(el => {
            el.addEventListener('input', ()=>{
                const pos = el.selectionStart;
                const val = parseCurrency(el.value);
                el.value = val === '' ? '' : formatCurrency(val);
                el.selectionStart = el.selectionEnd = pos;
            });
        });
    }

    function applyStateToControls(){
        // Groups - wait for checkboxes to be available
        const groupCheckboxes = groupOptionsEl.querySelectorAll('input[type="checkbox"]');
        if (groupCheckboxes.length === 0) {
            console.warn('No group checkboxes found. State will be applied after re-render.');
            return;
        }
        groupCheckboxes.forEach(cb => {
            cb.checked = state.groups.includes(cb.value);
        });
        // Price range
        const priceRadio = priceOptionsEl.querySelector(`input[value="${state.priceRange}"]`);
        if (priceRadio) priceRadio.checked = true; else priceOptionsEl.querySelector('input[value="all"]').checked = true;
        // Min/Max
        minPriceEl.value = state.min === '' ? '' : formatCurrency(state.min);
        maxPriceEl.value = state.max === '' ? '' : formatCurrency(state.max);
        sortSelect.value = state.sort;
    }

    function setupMobileFilter(){
        const isMobile = window.matchMedia('(max-width: 768px)').matches;
        if (isMobile) {
            filterPanel.classList.add('mobile');
        } else {
            filterPanel.classList.remove('mobile');
            filterPanel.style.transform = '';
            filterOverlay.style.display = 'none';
        }
    }

    function openMobileFilter(){
        if (!filterPanel.classList.contains('mobile')) return;
        filterPanel.classList.add('open');
        filterOverlay.style.display = 'block';
    }

    function closeMobileFilter(){
        if (!filterPanel.classList.contains('mobile')) return;
        filterPanel.classList.remove('open');
        filterOverlay.style.display = 'none';
    }

    if (productGridEl) {
        productGridEl.addEventListener('click', (e)=>{
            const viewBtn = e.target.closest('[data-product-id]');
            if (viewBtn && viewBtn.dataset.productId) {
                const pid = viewBtn.dataset.productId;
                openProductModal(pid);
            }
        });
    }

    window.addEventListener('resize', setupMobileFilter);
    mobileToggle.addEventListener('click', openMobileFilter);
    filterCloseBtn.addEventListener('click', closeMobileFilter);
    filterOverlay.addEventListener('click', closeMobileFilter);

    // Init
    renderPriceOptions();
    bindInputs();
    restoreFromUrl(); // Restore state from URL first
    setupMobileFilter();
    await loadProductsFromApi();

    // Re-apply URL state after data has loaded to ensure filters are active on first load
    restoreFromUrl();
    applyStateToControls();
    scheduleRender();

    // Check if there's a product ID in URL and open detail view
    const urlParams = new URLSearchParams(window.location.search);
    const productId = urlParams.get('id');
    if (productId) {
        // Small delay to ensure products are loaded
        setTimeout(() => {
            openProductModal(productId);
        }, 100);
    }

    // Handle navigation within same page (e.g., clicking category links)
    // Intercept clicks on links pointing to san-pham.php
    document.addEventListener('click', function(e) {
        const link = e.target.closest('a[href*="san-pham.php"]');
        if (link && window.location.pathname.includes('san-pham.php')) {
            const linkUrl = new URL(link.href);
            const currentUrl = new URL(window.location.href);
            // If clicking link to same page with different params, reload
            if (linkUrl.pathname === currentUrl.pathname && linkUrl.search !== currentUrl.search) {
                e.preventDefault();
                window.location.href = link.href;
                window.location.reload();
            }
        }
    });

    // Handle comment form submission
    document.addEventListener('submit', function(e) {
        if (e.target.id === 'commentForm') {
            e.preventDefault();
            
            const rating = document.querySelector('input[name="rating"]:checked')?.value || '3';
            const name = document.getElementById('commentName').value.trim();
            const text = document.getElementById('commentText').value.trim();
            
            if (!name || !text) {
                alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!');
                return;
            }
            
            // Create star display
            const ratingNum = parseInt(rating);
            let stars = '';
            for (let i = 0; i < 5; i++) {
                stars += i < ratingNum ? '‚òÖ' : '‚òÜ';
            }
            
            // Get current date
            const today = new Date();
            const dateStr = `${today.getDate().toString().padStart(2, '0')}/${(today.getMonth() + 1).toString().padStart(2, '0')}/${today.getFullYear()}`;
            
            // Add new comment to list
            const commentsList = document.getElementById('commentsList');
            const firstH3 = commentsList.querySelector('h3');
            
            const newComment = document.createElement('div');
            newComment.className = 'comment-item';
            newComment.style.animation = 'fadeIn 0.5s ease';
            newComment.innerHTML = `
                <div class="comment-header">
                    <div class="comment-author">${name}</div>
                    <div class="comment-rating">${stars}</div>
                </div>
                <div class="comment-date">${dateStr}</div>
                <div class="comment-text">${text}</div>
            `;
            
            // Insert after h3
            if (firstH3 && firstH3.nextSibling) {
                commentsList.insertBefore(newComment, firstH3.nextSibling);
            } else {
                commentsList.appendChild(newComment);
            }
            
            // Reset form
            e.target.reset();
            
            // Show success message
            alert('C·∫£m ∆°n b·∫°n ƒë√£ ƒë√°nh gi√° s·∫£n ph·∫©m!');
            
            // Scroll to new comment
            newComment.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    });
</script>
<style>
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}
</style>
<script>
let isLoggedIn = false;

// Account dropdown toggle
function handleAccountClick(event) {
    event.stopPropagation();
    const accountMenu = document.getElementById('accountMenu');
    if (!accountMenu) return;
    if (!isLoggedIn) {
        // N·∫øu c√≥ h√†m m·ªü modal ƒëƒÉng nh·∫≠p, d√πng n√≥; n·∫øu kh√¥ng, chuy·ªÉn v·ªÅ trang ch·ªß ƒë·ªÉ ƒëƒÉng nh·∫≠p
        if (typeof toggleLoginForm === 'function') {
            toggleLoginForm();
        } else {
            window.location.href = 'index.html';
        }
        return;
    }
    accountMenu.style.display = accountMenu.style.display === 'block' ? 'none' : 'block';
}

// Close account menu when clicking outside
document.addEventListener('click', function(event) {
    const accountDropdown = document.querySelector('.account-dropdown');
    const accountMenu = document.getElementById('accountMenu');
    if (accountDropdown && accountMenu && !accountDropdown.contains(event.target)) {
        accountMenu.style.display = 'none';
    }
});

// Check session and show username under icon
function checkLoginStatus() {
    fetch('/check_session.php')
        .then(response => response.json())
        .then(data => {
            const accountDropdown = document.querySelector('.account-dropdown');
            const usernameDisplay = document.getElementById('usernameDisplay');
            if (data.logged_in) {
                isLoggedIn = true;
                if (accountDropdown) accountDropdown.classList.add('logged-in');
                if (usernameDisplay) {
                    usernameDisplay.innerText = data.username || '';
                    usernameDisplay.style.display = 'block';
                }
            } else {
                isLoggedIn = false;
                if (accountDropdown) accountDropdown.classList.remove('logged-in');
                if (usernameDisplay) {
                    usernameDisplay.style.display = 'none';
                }
            }
        })
        .catch(() => {});
}

document.addEventListener('DOMContentLoaded', checkLoginStatus);

// Hi·ªÉn th·ªã lo·∫°i theo click (kh√¥ng c·∫ßn hover)
document.querySelectorAll('.submenu-content .brand-item').forEach(item => {
    item.addEventListener('click', function(e) {
        e.preventDefault();
        const categoryName = this.getAttribute('data-category') || this.textContent.trim();
        const categoryDetail = document.getElementById('categoryDetail');
        
        if (window.categoryData && window.categoryData[categoryName] && categoryDetail) {
            const items = window.categoryData[categoryName];
            const itemsPerColumn = Math.ceil(items.length / 3);
            
            let columns = ['', '', ''];
            items.forEach((item, index) => {
                const columnIndex = Math.floor(index / itemsPerColumn);
                columns[columnIndex] += `<li class="detail-item" data-group="${categoryName}" data-type="${item}">${item}</li>`;
            });
            
            categoryDetail.innerHTML = `
                <div class="detail-column">
                    <h4>${categoryName}</h4>
                    <ul>${columns[0]}</ul>
                </div>
                <div class="detail-column">
                    <ul>${columns[1]}</ul>
                </div>
                <div class="detail-column">
                    <ul>${columns[2]}</ul>
                </div>
            `;
        }
    });
});

// Desktop hover detail click-through
const detailEl = document.getElementById('categoryDetail');
if (detailEl) {
    detailEl.addEventListener('click', function(e) {
        const li = e.target.closest('.detail-item');
        if (!li) return;
        const group = li.getAttribute('data-group') || '';
        const type = li.getAttribute('data-type') || '';
        const url = `san-pham.html?groups=${encodeURIComponent(group)}&types=${encodeURIComponent(type)}`;
        window.location.href = url;
    });
}

// Unified dropdown & mobile menu logic (reuse categoryData)
document.addEventListener('DOMContentLoaded', function() {
    const dropdown = document.querySelector('.dropdown');
    if (!dropdown) return;

    const dropdownBtn = dropdown.querySelector('.dropdown-btn');
    const dropdownContent = dropdown.querySelector('.dropdown-content');
    const originalMenuHTML = dropdownContent.innerHTML;

    const categoryIcons = {
        'Gi∆∞·ªùng': 'icon-hinhdanhmuc/nhom-giuong.png',
        'Xe lƒÉn': 'icon-hinhdanhmuc/nhom-xelan.png',
        'Xe Scooter ƒëi·ªán': 'icon-hinhdanhmuc/nhom-xedien.png',
        'BƒÉng ca': 'icon-hinhdanhmuc/nhom-bangca.png',
        'T·ªß': 'icon-hinhdanhmuc/nhom-tu.png',
        'M√°y t·∫°o oxy': 'icon-hinhdanhmuc/nhom-maytaooxy.png',
        'M√°y ƒëo': 'icon-hinhdanhmuc/nhom-maydo.png',
        'M√°y x√¥ng': 'icon-hinhdanhmuc/nhom-xong.png',
        'M√°y h√∫t d·ªãch': 'icon-hinhdanhmuc/nhom-mayhutdich.png',
        'M√°y massage': 'icon-hinhdanhmuc/nhom-massage.png',
        'Thi·∫øt b·ªã t·∫≠p': 'icon-hinhdanhmuc/nhom-maytap.png',
        'N·ªám': 'icon-hinhdanhmuc/nhom-nem.png',
        'D·ª•ng c·ª• h·ªó tr·ª£': 'icon-hinhdanhmuc/nhom-dungcuhotro.png',
        'Thi·∫øt b·ªã y t·∫ø kh√°c': 'icon-hinhdanhmuc/nhom-thietbiyte.png'
    };

    function createProductCategoryHTML() {
        let gridHTML = '<div class="mobile-category-grid">';
        Object.keys(window.categoryData || {}).forEach(categoryName => {
            const iconPath = categoryIcons[categoryName] || '';
            gridHTML += `
                <div class="mobile-category-item" data-category="${categoryName}">
                    <img src="${iconPath}" alt="${categoryName}" class="mobile-category-icon">
                    <span>${categoryName}</span>
                </div>
            `;
        });
        gridHTML += '</div>';

        return `
            <div class="mobile-menu-header">
                <button class="mobile-menu-back-btn">‚Äπ Quay l·∫°i</button>
                <h3>Danh m·ª•c s·∫£n ph·∫©m</h3>
            </div>
            ${gridHTML}
        `;
    }

    dropdownBtn.addEventListener('click', function(event) {
        if (window.innerWidth <= 768) {
            event.preventDefault();
            event.stopPropagation();
            dropdown.classList.toggle('mobile-menu-active');
        }
    });

    dropdownContent.addEventListener('click', function(event) {
        if (window.innerWidth > 768) return;
        const target = event.target;

        if (target.matches('.has-submenu')) {
            event.preventDefault();
            dropdownContent.innerHTML = createProductCategoryHTML();
        }

        if (target.matches('.mobile-menu-back-btn')) {
            dropdownContent.innerHTML = originalMenuHTML;
        }

        const categoryItem = target.closest('.mobile-category-item');
        if (categoryItem) {
            const categoryName = categoryItem.getAttribute('data-category');
            if (categoryName) {
                dropdown.classList.remove('mobile-menu-active');
                const targetUrl = `san-pham.html?groups=${encodeURIComponent(categoryName)}`;
                window.location.href = targetUrl;
            }
        }

        const subCategoryItem = target.closest('.mobile-subcategory-item');
        if (subCategoryItem) {
            const subName = subCategoryItem.textContent.trim();
            dropdown.classList.remove('mobile-menu-active');
            const targetUrl = `san-pham.html?types=${encodeURIComponent(subName)}`;
            window.location.href = targetUrl;
        }
    });

    document.addEventListener('click', function(event) {
        if (window.innerWidth <= 768) {
            if (!dropdown.contains(event.target)) {
                dropdown.classList.remove('mobile-menu-active');
            }
        }
    });

    window.addEventListener('resize', function() {
        dropdown.classList.remove('mobile-menu-active');
        dropdownContent.innerHTML = originalMenuHTML;
        if (window.innerWidth > 768) {
            dropdownContent.style.display = '';
        }
    });
});
</script>
<!-- Profile Modal include -->
<div id="profileModal" class="profile-modal" style="display: none;">
    <div class="profile-modal-content">
        <span class="profile-close" onclick="closeProfileModal()">&times;</span>
        <h2>Th√¥ng tin t√†i kho·∫£n</h2>
        <div class="profile-avatar-section">
            <img id="profileAvatar" src="hinh-anh/hinh-tk-macdinh.png" alt="Avatar" class="profile-avatar-img">
            <input type="file" id="avatarInput" accept="image/*" style="display: none;" onchange="handleAvatarUpload(event)">
            <button class="profile-btn-secondary" onclick="document.getElementById('avatarInput').click()">Ch·ªânh s·ª≠a avatar</button>
        </div>
        <div class="profile-info-section">
            <div class="profile-field">
                <label>T√™n ng∆∞·ªùi d√πng:</label>
                <input type="text" id="profileUsername" class="profile-input" readonly>
                <button class="profile-btn-edit" onclick="enableEdit('profileUsername')">‚úèÔ∏è</button>
            </div>
            <div class="profile-field">
                <label>S·ªë ƒëi·ªán tho·∫°i:</label>
                <input type="text" id="profilePhone" class="profile-input" readonly>
                <button class="profile-btn-change" onclick="openChangePhoneModal()">Thay ƒë·ªïi</button>
            </div>
            <div class="profile-field">
                <label>Email:</label>
                <input type="email" id="profileEmail" class="profile-input" readonly>
                <button class="profile-btn-change" onclick="openChangeEmailModal()">Thay ƒë·ªïi</button>
            </div>
            <div class="profile-field">
                <label>M·∫≠t kh·∫©u:</label>
                <input type="password" id="profilePassword" class="profile-input" value="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" readonly>
                <a href="#" class="profile-link-change" onclick="openChangePasswordModal(); return false;">Thay ƒë·ªïi m·∫≠t kh·∫©u</a>
            </div>
            <div class="profile-field">
                <label>ƒê·ªãa ch·ªâ:</label>
                <textarea id="profileAddress" class="profile-textarea" rows="3"></textarea>
            </div>
            <button class="profile-btn-primary" onclick="saveProfileChanges()">L∆∞u thay ƒë·ªïi</button>
        </div>
    </div>
    </div>
    <div id="changePasswordModal" class="profile-modal" style="display: none;">
        <div class="profile-modal-content profile-modal-small">
            <span class="profile-close" onclick="closeChangePasswordModal()">&times;</span>
            <h3>Thay ƒë·ªïi m·∫≠t kh·∫©u</h3>
            <div class="profile-field">
                <label>M·∫≠t kh·∫©u c≈©:</label>
                <input type="password" id="oldPassword" class="profile-input">
            </div>
            <div class="profile-field">
                <label>M·∫≠t kh·∫©u m·ªõi:</label>
                <input type="password" id="newPassword" class="profile-input">
            </div>
            <div class="profile-field">
                <label>M√£ x√°c nh·∫≠n:</label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="passwordVerifyCode" class="profile-input" style="flex: 1;">
                    <button class="profile-btn-secondary" onclick="sendPasswordVerificationCode()">G·ª≠i m√£</button>
                </div>
                <small style="color: #666;">M√£ x√°c nh·∫≠n s·∫Ω ƒë∆∞·ª£c g·ª≠i ƒë·∫øn email c·ªßa b·∫°n</small>
            </div>
            <button class="profile-btn-primary" onclick="updatePassword()">C·∫≠p nh·∫≠t m·∫≠t kh·∫©u</button>
        </div>
    </div>
    <div id="changePhoneModal" class="profile-modal" style="display: none;">
        <div class="profile-modal-content profile-modal-small">
            <span class="profile-close" onclick="closeChangePhoneModal()">&times;</span>
            <h3>Thay ƒë·ªïi s·ªë ƒëi·ªán tho·∫°i</h3>
            <div class="profile-field">
                <label>S·ªë ƒëi·ªán tho·∫°i m·ªõi:</label>
                <input type="text" id="newPhone" class="profile-input">
            </div>
            <div class="profile-field">
                <label>M√£ x√°c nh·∫≠n:</label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="phoneVerifyCode" class="profile-input" style="flex: 1;">
                    <button class="profile-btn-secondary" onclick="sendPhoneVerificationCode()">G·ª≠i m√£</button>
                </div>
                <small style="color: #666;">M√£ x√°c nh·∫≠n s·∫Ω ƒë∆∞·ª£c g·ª≠i ƒë·∫øn SƒêT m·ªõi</small>
            </div>
            <button class="profile-btn-primary" onclick="updatePhone()">C·∫≠p nh·∫≠t SƒêT</button>
        </div>
    </div>
    <div id="changeEmailModal" class="profile-modal" style="display: none;">
        <div class="profile-modal-content profile-modal-small">
            <span class="profile-close" onclick="closeChangeEmailModal()">&times;</span>
            <h3>Thay ƒë·ªïi Email</h3>
            <div class="profile-field">
                <label>Email m·ªõi:</label>
                <input type="email" id="newEmail" class="profile-input">
            </div>
            <div class="profile-field">
                <label>M√£ x√°c nh·∫≠n:</label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="emailVerifyCode" class="profile-input" style="flex: 1;">
                    <button class="profile-btn-secondary" onclick="sendEmailVerificationCode()">G·ª≠i m√£</button>
                </div>
                <small style="color: #666;">M√£ x√°c nh·∫≠n s·∫Ω ƒë∆∞·ª£c g·ª≠i ƒë·∫øn email m·ªõi</small>
            </div>
            <button class="profile-btn-primary" onclick="updateEmail()">C·∫≠p nh·∫≠t Email</button>
        </div>
    </div>
});
<footer class="footer">
    <div class="container">
        <div class="footer-content">
            <div class="footer-column">
                <h3>H·ªó tr·ª£ kh√°ch h√†ng</h3>
                <ul>
                    <li>Hotline: 0937 043 808</li>
                    <li>(8-21h k·ªÉ c·∫£ T7, CN)</li>
                    <li>ƒêi·ªÅu kho·∫£n d·ªãch v·ª•</li>
                    <li>Ch√≠nh s√°ch ph·ª•c v·ª•</li>
                    <li>Ch√≠nh s√°ch ƒë·ªïi tr·∫£</li>
                    <li>Ch√≠nh s√°ch b·∫£o m·∫≠t</li>
                    <li>Ch√≠nh s√°ch v·∫≠n chuy·ªÉn</li>
                    <li>Ch√≠nh s√°ch thanh to√°n</li>
                    <li>Ch√≠nh s√°ch b·∫£o h√†nh</li>
                    <li>H·ªó tr·ª£ kh√°ch h√†ng: ducphuongmedical@gmail.com</li>
                </ul>
            </div>
            
            <div class="footer-column">
                <h3>B·∫£n tin s·ª©c kh·ªèe</h3>
                <ul>
                    <li>Tin t·ª©c v·ªÅ gi∆∞·ªùng b·ªánh nh√¢n</li>
                    <li>H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng gi∆∞·ªùng b·ªánh</li>
                    <li>H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng xe lƒÉn ƒëi·ªán</li>
                    <li>Tin t·ª©c v·ªÅ m√°y t·∫°o Oxy</li>
                    <li>Tin t·ª©c v·ªÅ Xe LƒÉn</li>
                </ul>
            </div>
            
            <div class="footer-column">
                <h3>Ph∆∞∆°ng th·ª©c thanh to√°n</h3>
                <div class="payment-methods">
                    <img src="hinh-thanhtoan/visa.png" alt="Visa">
                    <img src="hinh-thanhtoan/mastercard.png" alt="Mastercard">
                    <img src="hinh-thanhtoan/jcb.png" alt="JCB">
                    <img src="hinh-thanhtoan/momo.png" alt="MoMo">
                </div>
                
                <h4>D·ªãch v·ª• giao h√†ng</h4>
                <div class="delivery-services">
                    <img src="hinh-anh/giao-hang.png" alt="Giao h√†ng">
                </div>
            </div>
            
            <div class="footer-column">
                <h3>K·∫øt n·ªëi v·ªõi ch√∫ng t√¥i</h3>
                <div class="social-links">
                    <a href="https://www.facebook.com/ducphuongnguyenphuoctay" target="_blank">
                        <img src="hinh-anh/fb-logo.png" alt="Facebook">
                    </a>
                    <a href="https://youtube.com/@ducphuongmedical" target="_blank">
                        <img src="hinh-anh/youtube-icon.png" alt="YouTube">
                    </a>
                    <a href="https://zalo.me/0938.062.808" target="_blank">
                        <img src="hinh-anh/icon-zalo.png" alt="Zalo">
                    </a>
                    <a href="https://mail.google.com/mail/?view=cm&fs=1&to=ducphuongmedical@gmail.com" target="_blank">
                        <img src="hinh-anh/icon-gmail.png" alt="Gmail">
                    </a>
                </div>
                
                <div class="certificates">
                    <h4>Ch·ª©ng nh·∫≠n b·ªüi</h4>
                    <div class="cert-logos">
                        <img src="hinh-anh/icon-ddk.png" alt="ƒê√£ ƒëƒÉng k√Ω">
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <div class="footer-bottom-content">
                <div class="company-info">
                    <p>ƒê·ªãa ch·ªâ: 12 ƒê√¥ng H·ªì, Ph∆∞·ªùng 08, Qu·∫≠n T√¢n B√¨nh, TP.HCM</p>
                    <p>TaJerMy nh·∫≠n ƒë·∫∑t h√†ng tr·ª±c tuy·∫øn v√† giao h√†ng t·∫≠n n∆°i ho·∫∑c mua h√†ng tr·ª±c ti·∫øp t·∫°i c·ª≠a h√†ng</p>
                    <p>Gi·∫•y ch·ª©ng nh·∫≠n ƒêƒÉng k√Ω Kinh doanh s·ªë 0313717853 do S·ªü K·∫ø ho·∫°ch v√† ƒê·∫ßu t∆∞ Th√†nh ph·ªë H·ªì Ch√≠ Minh c·∫•p ng√†y 25/03/2016</p>
                    <p>&copy; 2022 - B·∫£n quy·ªÅn c·ªßa TaJerMy - www.ducphuongmedical.com. C·∫•m sao ch√©p d∆∞·ªõi m·ªçi h√¨nh th·ª©c n·∫øu kh√¥ng c√≥ s·ª± ch·∫•p thu·∫≠n b·∫±ng vƒÉn b·∫£n.</p>
                </div>
            </div>
        </div>
    </div>
</footer>

<script type="module" src="search-suggestions.js"></script>
<script src="profile-modal.js"></script>
</body>
</html>