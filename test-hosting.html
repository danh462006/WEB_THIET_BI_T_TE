<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEST - Ki·ªÉm tra k·∫øt n·ªëi database v√† API</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 900px; margin: 0 auto; }
        h1 { color: #333; margin-bottom: 20px; }
        .test-section { background: white; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .test-section h2 { color: #0066cc; margin-bottom: 15px; font-size: 18px; }
        .status { padding: 10px; border-radius: 4px; margin-bottom: 10px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        .loading { background: #fff3cd; border: 1px solid #ffeeba; color: #856404; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px; }
        button { background: #0066cc; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-size: 14px; }
        button:hover { background: #0052a3; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-top: 15px; }
        .product-card { background: #f8f9fa; padding: 10px; border-radius: 4px; border: 1px solid #dee2e6; }
        .product-card img { width: 100%; height: 120px; object-fit: cover; border-radius: 4px; background: #e9ecef; }
        .product-name { font-weight: 600; margin-top: 8px; font-size: 13px; }
        .product-price { color: #d97706; font-weight: 600; margin-top: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß C√¥ng c·ª• ki·ªÉm tra hosting</h1>
        
        <div class="test-section">
            <h2>1. Ki·ªÉm tra th√¥ng tin server</h2>
            <div id="serverInfo" class="status loading">ƒêang ki·ªÉm tra...</div>
        </div>

        <div class="test-section">
            <h2>2. Ki·ªÉm tra k·∫øt n·ªëi Database</h2>
            <div id="dbStatus" class="status loading">ƒêang ki·ªÉm tra...</div>
        </div>

        <div class="test-section">
            <h2>3. Ki·ªÉm tra API s·∫£n ph·∫©m</h2>
            <button onclick="testAPI()">Ki·ªÉm tra API</button>
            <div id="apiStatus" class="status info" style="margin-top: 10px;">Nh·∫•n n√∫t ƒë·ªÉ test API</div>
            <div id="apiResponse"></div>
        </div>

        <div class="test-section">
            <h2>4. Danh s√°ch s·∫£n ph·∫©m (t·ª´ API)</h2>
            <div id="productCount" class="status info">Ch∆∞a load</div>
            <div id="productGrid" class="product-grid"></div>
        </div>

        <div class="test-section">
            <h2>5. Ki·ªÉm tra ƒë∆∞·ªùng d·∫´n file</h2>
            <div id="pathInfo" class="status loading">ƒêang ki·ªÉm tra...</div>
        </div>
    </div>

    <script>
        // 1. Server Info
        const serverInfo = {
            'User Agent': navigator.userAgent,
            'Current URL': window.location.href,
            'Protocol': window.location.protocol,
            'Host': window.location.host,
            'Pathname': window.location.pathname
        };
        
        document.getElementById('serverInfo').innerHTML = `
            <div class="success">‚úì Th√¥ng tin tr√¨nh duy·ªát</div>
            <pre>${JSON.stringify(serverInfo, null, 2)}</pre>
        `;

        // 2. Database check (through API)
        async function checkDatabase() {
            try {
                const res = await fetch('api/admin_product_list.php?limit=1');
                const data = await res.json();
                
                if (data.success) {
                    document.getElementById('dbStatus').innerHTML = `
                        <div class="success">‚úì K·∫øt n·ªëi database th√†nh c√¥ng!</div>
                        <div style="margin-top: 10px;">T·ªïng s·∫£n ph·∫©m: <strong>${data.data ? data.data.length : 0}</strong></div>
                    `;
                } else {
                    throw new Error(data.error || 'API tr·∫£ v·ªÅ success=false');
                }
            } catch (err) {
                document.getElementById('dbStatus').innerHTML = `
                    <div class="error">‚úó L·ªói k·∫øt n·ªëi database!</div>
                    <div style="margin-top: 10px;">${err.message}</div>
                    <pre>${err.stack || ''}</pre>
                `;
            }
        }
        checkDatabase();

        // 3. API Test
        async function testAPI() {
            const statusEl = document.getElementById('apiStatus');
            const responseEl = document.getElementById('apiResponse');
            
            statusEl.innerHTML = '<div class="loading">‚è≥ ƒêang g·ªçi API...</div>';
            responseEl.innerHTML = '';
            
            try {
                const startTime = Date.now();
                const res = await fetch('api/admin_product_list.php');
                const endTime = Date.now();
                
                if (!res.ok) {
                    throw new Error(`HTTP ${res.status}: ${res.statusText}`);
                }
                
                const data = await res.json();
                const responseTime = endTime - startTime;
                
                if (data.success) {
                    statusEl.innerHTML = `
                        <div class="success">‚úì API ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng!</div>
                        <div style="margin-top: 10px;">
                            Response time: <strong>${responseTime}ms</strong><br>
                            S·ªë s·∫£n ph·∫©m: <strong>${data.data ? data.data.length : 0}</strong>
                        </div>
                    `;
                    
                    responseEl.innerHTML = `<pre>${JSON.stringify(data, null, 2).substring(0, 2000)}...</pre>`;
                    
                    // Load products
                    loadProducts(data.data);
                } else {
                    throw new Error(data.error || 'API tr·∫£ v·ªÅ success=false');
                }
            } catch (err) {
                statusEl.innerHTML = `
                    <div class="error">‚úó L·ªói API!</div>
                    <div style="margin-top: 10px;">${err.message}</div>
                `;
                responseEl.innerHTML = `<pre>${err.stack || ''}</pre>`;
            }
        }

        // 4. Load Products
        function loadProducts(products) {
            const gridEl = document.getElementById('productGrid');
            const countEl = document.getElementById('productCount');
            
            if (!products || products.length === 0) {
                countEl.innerHTML = '<div class="error">‚úó Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o!</div>';
                gridEl.innerHTML = '';
                return;
            }
            
            countEl.innerHTML = `<div class="success">‚úì T√¨m th·∫•y ${products.length} s·∫£n ph·∫©m</div>`;
            
            // Show first 8 products
            const displayProducts = products.slice(0, 8);
            gridEl.innerHTML = displayProducts.map(p => {
                const imgSrc = p.thumbnail_path || 'https://via.placeholder.com/200x120?text=No+Image';
                const price = p.sale_price || p.original_price || 0;
                return `
                    <div class="product-card">
                        <img src="${imgSrc}" alt="${p.name}" onerror="this.src='https://via.placeholder.com/200x120?text=Error'">
                        <div class="product-name">${p.name}</div>
                        <div class="product-price">${price.toLocaleString('vi-VN')} ƒë</div>
                    </div>
                `;
            }).join('');
        }

        // 5. Path check
        const paths = [
            'api/admin_product_list.php',
            '/config.php',
            '/san-pham.html',
            '/style.css'
        ];
        
        async function checkPaths() {
            const results = [];
            for (const path of paths) {
                try {
                    const res = await fetch(path, { method: 'HEAD' });
                    results.push(`${res.ok ? '‚úì' : '‚úó'} ${path} - ${res.status} ${res.statusText}`);
                } catch (err) {
                    results.push(`‚úó ${path} - ${err.message}`);
                }
            }
            
            document.getElementById('pathInfo').innerHTML = `
                <div class="info">K·∫øt qu·∫£ ki·ªÉm tra ƒë∆∞·ªùng d·∫´n:</div>
                <pre>${results.join('\n')}</pre>
            `;
        }
        checkPaths();

        // Auto test API on load
        setTimeout(testAPI, 500);
    </script>
</body>
</html>
