<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TBYT ƒê·ª©c Ph∆∞∆°ng</title>
    <link rel="icon" type="image/png" href="hinh-anh/logo-favicon.png">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="category-style.css">
    <link rel="stylesheet" href="profile-modal.css">
    <link rel="stylesheet" href="mobile-responsive.css">
    <script src="auth-redirect.js"></script>
    <script src="profile-modal.js"></script>
    <style>
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal-content {
            animation: fadeInDown 0.4s ease-out;
        }
    </style>
</head>
<body>
    <!-- Profile Modal System -->
    <div id="profileModal" class="profile-modal" style="display: none;">
        <div class="profile-modal-content">
            <span class="profile-close" onclick="closeProfileModal()">&times;</span>
            <h2>Th√¥ng tin t√†i kho·∫£n</h2>
            <div class="profile-avatar-section">
                <img id="profileAvatar" src="hinh-anh/hinh-tk-macdinh.png" alt="Avatar" class="profile-avatar-img">
                <input type="file" id="avatarInput" accept="image/*" style="display: none;" onchange="handleAvatarUpload(event)">
                <button class="profile-btn-secondary" onclick="document.getElementById('avatarInput').click()">Ch·ªânh s·ª≠a avatar</button>
            </div>
            <div class="profile-info-section">
                <div class="profile-field"><label>T√™n ng∆∞·ªùi d√πng:</label><input type="text" id="profileUsername" class="profile-input" readonly><button class="profile-btn-edit" onclick="enableEdit('profileUsername')">‚úèÔ∏è</button></div>
                <div class="profile-field"><label>S·ªë ƒëi·ªán tho·∫°i:</label><input type="text" id="profilePhone" class="profile-input" readonly><button class="profile-btn-change" onclick="openChangePhoneModal()">Thay ƒë·ªïi</button></div>
                <div class="profile-field"><label>Email:</label><input type="email" id="profileEmail" class="profile-input" readonly><button class="profile-btn-change" onclick="openChangeEmailModal()">Thay ƒë·ªïi</button></div>
                <div class="profile-field"><label>M·∫≠t kh·∫©u:</label><div style="position: relative; flex: 1;"><input type="password" id="profilePassword" class="profile-input" value="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" readonly style="width: 100%;"><span onclick="togglePasswordVisibility()" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; user-select: none; font-size: 18px;">üëÅÔ∏è</span></div><a href="#" class="profile-link-change" onclick="openChangePasswordModal(); return false;">Thay ƒë·ªïi m·∫≠t kh·∫©u</a></div>
                <div class="profile-field"><label>ƒê·ªãa ch·ªâ:</label><textarea id="profileAddress" class="profile-textarea" rows="3"></textarea></div>
                <button class="profile-btn-primary" onclick="saveProfileChanges()">L∆∞u thay ƒë·ªïi</button>
            </div>
        </div>
    </div>
    <div id="changePasswordModal" class="profile-modal" style="display: none;">
        <div class="profile-modal-content profile-modal-small">
            <span class="profile-close" onclick="closeChangePasswordModal()">&times;</span>
            <h3>Thay ƒë·ªïi m·∫≠t kh·∫©u</h3>
            <div class="profile-field"><label>M·∫≠t kh·∫©u c≈©:</label><input type="password" id="oldPassword" class="profile-input"></div>
            <div class="profile-field"><label>M·∫≠t kh·∫©u m·ªõi:</label><input type="password" id="newPassword" class="profile-input"></div>
            <div class="profile-field"><label>M√£ x√°c nh·∫≠n:</label><div style="display: flex; gap: 10px;"><input type="text" id="passwordVerifyCode" class="profile-input" style="flex: 1;"><button class="profile-btn-secondary" onclick="sendPasswordVerificationCode()">G·ª≠i m√£</button></div><small style="color: #666;">M√£ x√°c nh·∫≠n s·∫Ω ƒë∆∞·ª£c g·ª≠i ƒë·∫øn email c·ªßa b·∫°n</small></div>
            <button class="profile-btn-primary" onclick="updatePassword()">C·∫≠p nh·∫≠t m·∫≠t kh·∫©u</button>
        </div>
    </div>
    <div id="changePhoneModal" class="profile-modal" style="display: none;">
        <div class="profile-modal-content profile-modal-small">
            <span class="profile-close" onclick="closeChangePhoneModal()">&times;</span>
            <h3>Thay ƒë·ªïi s·ªë ƒëi·ªán tho·∫°i</h3>
            <div class="profile-field"><label>S·ªë ƒëi·ªán tho·∫°i m·ªõi:</label><input type="text" id="newPhone" class="profile-input"></div>
            <div class="profile-field"><label>M√£ x√°c nh·∫≠n:</label><div style="display: flex; gap: 10px;"><input type="text" id="phoneVerifyCode" class="profile-input" style="flex: 1;"><button class="profile-btn-secondary" onclick="sendPhoneVerificationCode()">G·ª≠i m√£</button></div><small style="color: #666;">M√£ x√°c nh·∫≠n s·∫Ω ƒë∆∞·ª£c g·ª≠i ƒë·∫øn SƒêT m·ªõi</small></div>
            <button class="profile-btn-primary" onclick="updatePhone()">C·∫≠p nh·∫≠t SƒêT</button>
        </div>
    </div>
    <div id="changeEmailModal" class="profile-modal" style="display: none;">
        <div class="profile-modal-content profile-modal-small">
            <span class="profile-close" onclick="closeChangeEmailModal()">&times;</span>
            <h3>Thay ƒë·ªïi Email</h3>
            <div class="profile-field"><label>Email m·ªõi:</label><input type="email" id="newEmail" class="profile-input"></div>
            <div class="profile-field"><label>M√£ x√°c nh·∫≠n:</label><div style="display: flex; gap: 10px;"><input type="text" id="emailVerifyCode" class="profile-input" style="flex: 1;"><button class="profile-btn-secondary" onclick="sendEmailVerificationCode()">G·ª≠i m√£</button></div><small style="color: #666;">M√£ x√°c nh·∫≠n s·∫Ω ƒë∆∞·ª£c g·ª≠i ƒë·∫øn email m·ªõi</small></div>
            <button class="profile-btn-primary" onclick="updateEmail()">C·∫≠p nh·∫≠t Email</button>
        </div>
    </div>

    <header class="header">
        <div class="container">
            <div class="logo-section">
                <img src="hinh-anh/logo.png" alt="TBYT ƒê·ª©c Ph∆∞∆°ng" class="logo">
            </div>
            
            <div class="search-section">
                <div class="search-box">
                    <input type="text" placeholder="T√¨m Ki·∫øm ..." class="search-input" autocomplete="off">
                    <button class="search-btn">üîç</button>
                </div>
                <div class="search-suggestions" id="searchSuggestions"></div>
            </div>
            
            <div class="user-section">
                <div class="account-dropdown">
                    <button class="account-btn" onclick="handleAccountClick(event)">
                        <img src="hinh-anh/icon_tk.png" alt="T√†i kho·∫£n" class="account-icon">
                    </button>
                    <div id="usernameDisplay" class="username-display" style="display: none;"></div>
                    <div class="account-menu" id="accountMenu" style="min-width: 150px; right: 0; left: auto;">
                        <a href="#" onclick="event.stopPropagation(); openProfileModal(); return false;">Th√¥ng tin t√†i kho·∫£n</a>
                        <a href="#">ƒê∆°n h√†ng c·ªßa t√¥i</a>
                        <a href="#" onclick="handleLogout(); return false;">ƒêƒÉng xu·∫•t</a>
                    </div>
                </div>
                <button class="cart-btn">üõí Gi·ªè h√†ng</button>
                <div class="dropdown">
                    <button class="dropdown-btn">üìã Danh m·ª•c ‚ñº</button>
                    <div class="dropdown-content">
                        <a href="index.html">Trang ch·ªß</a>
                        <div class="dropdown-item-with-submenu">
                            <a href="#" class="has-submenu">S·∫£n ph·∫©m</a>
                            <div class="submenu">
                                <div class="submenu-content">
                                    <div class="category-header">
                                        <h3>üî• G·ª£i √Ω cho b·∫°n</h3>
                                    </div>
                                    
                                    <div class="category-brands">
                                        <div class="brand-item" data-category="Gi∆∞·ªùng"><img src="icon-hinhdanhmuc/nhom-giuong.png" alt="Gi∆∞·ªùng" class="category-icon">Gi∆∞·ªùng</div>
                                        <div class="brand-item" data-category="Xe lƒÉn"><img src="icon-hinhdanhmuc/nhom-xelan.png" alt="Xe lƒÉn" class="category-icon">Xe lƒÉn</div>
                                        <div class="brand-item" data-category="Xe Scooter ƒëi·ªán"><img src="icon-hinhdanhmuc/nhom-xedien.png" alt="Xe Scooter ƒëi·ªán" class="category-icon">Xe Scooter ƒëi·ªán</div>
                                        <div class="brand-item" data-category="BƒÉng ca"><img src="icon-hinhdanhmuc/nhom-bangca.png" alt="BƒÉng ca" class="category-icon">BƒÉng ca</div>
                                        <div class="brand-item" data-category="T·ªß"><img src="icon-hinhdanhmuc/nhom-tu.png" alt="T·ªß" class="category-icon">T·ªß</div>
                                        <div class="brand-item" data-category="M√°y t·∫°o oxy"><img src="icon-hinhdanhmuc/nhom-maytaooxy.png" alt="M√°y t·∫°o oxy" class="category-icon">M√°y t·∫°o oxy</div>
                                        <div class="brand-item" data-category="M√°y ƒëo"><img src="icon-hinhdanhmuc/nhom-maydo.png" alt="M√°y ƒëo" class="category-icon">M√°y ƒëo</div>
                                        <div class="brand-item" data-category="M√°y x√¥ng"><img src="icon-hinhdanhmuc/nhom-xong.png" alt="M√°y x√¥ng" class="category-icon">M√°y x√¥ng</div>
                                        <div class="brand-item" data-category="M√°y h√∫t d·ªãch"><img src="icon-hinhdanhmuc/nhom-mayhutdich.png" alt="M√°y h√∫t d·ªãch" class="category-icon">M√°y h√∫t d·ªãch</div>
                                        <div class="brand-item" data-category="M√°y massage"><img src="icon-hinhdanhmuc/nhom-massage.png" alt="M√°y massage" class="category-icon">M√°y massage</div>
                                        <div class="brand-item" data-category="Thi·∫øt b·ªã t·∫≠p"><img src="icon-hinhdanhmuc/nhom-maytap.png" alt="Thi·∫øt b·ªã t·∫≠p" class="category-icon">Thi·∫øt b·ªã t·∫≠p</div>
                                        <div class="brand-item" data-category="N·ªám"><img src="icon-hinhdanhmuc/nhom-nem.png" alt="N·ªám" class="category-icon">N·ªám</div>
                                        <div class="brand-item" data-category="D·ª•ng c·ª• h·ªó tr·ª£"><img src="icon-hinhdanhmuc/nhom-dungcuhotro.png" alt="D·ª•ng c·ª• h·ªó tr·ª£" class="category-icon">D·ª•ng c·ª• h·ªó tr·ª£</div>
                                        <div class="brand-item" data-category="Thi·∫øt b·ªã y t·∫ø kh√°c"><img src="icon-hinhdanhmuc/nhom-thietbiyte.png" alt="Thi·∫øt b·ªã y t·∫ø kh√°c" class="category-icon">Thi·∫øt b·ªã y t·∫ø kh√°c</div>
                                    </div>

                                    <div class="category-main">
                                        <div class="category-detail" id="categoryDetail">
                                            <p>Di chu·ªôt v√†o c√°c nh√≥m s·∫£n ph·∫©m ·ªü tr√™n ƒë·ªÉ xem chi ti·∫øt</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <a href="thong-tin.html">Gi·ªõi thi·ªáu</a>
                        <a href="tin-tuc.html">Tin t·ª©c - Ki·∫øn th·ª©c</a>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <main>
        <section class="intro-section reveal">
            <div class="container">
                <img src="hinh-anh/anh-trangchu.png" alt="Gi·ªõi thi·ªáu ƒê·ª©c Ph∆∞∆°ng Medical" class="intro-image">
            </div>
        </section>
    
    <section class="slideshow-section reveal">
        <div class="container">
            <div class="slideshow-layout">
                <div class="info-columns">
                    <div class="info-item">
                        <div class="info-icon">
                            <div class="icon-circle">
                                <span>üëÅ</span>
                            </div>
                        </div>
                        <h3>T·∫¶M NH√åN</h3>
                        <p>ƒê·ª©c Ph∆∞∆°ng h∆∞·ªõng t·ªõi tr·ªü th√†nh ƒë∆°n v·ªã ph√¢n ph·ªëi thi·∫øt b·ªã y t·∫ø h√†ng ƒë·∫ßu Vi·ªát Nam g√≥p ph·∫ßn n√¢ng cao ch·∫•t l∆∞·ª£ng chƒÉm s√≥c s·ª©c kh·ªèe trong n∆∞·ªõc v√† mang l·∫°i nh·ªØng gi·∫£i ph√°p chƒÉm s√≥c to√†n di·ªán cho m·ªçi gia ƒë√¨nh.</p>
                    </div>
                    <div class="info-item">
                        <div class="info-icon">
                            <div class="icon-circle">
                                <span>üéØ</span>
                            </div>
                        </div>
                        <h3>S·ª® M·ªÜNH</h3>
                        <p>- Cung c·∫•p s·∫£n ph·∫©m ch·∫•t l∆∞·ª£ng - an to√†n - b·ªÅn v·ªØng cho m·ªçi ng∆∞·ªùi d√πng<br>
                        - ƒêem l·∫°i nh·ªØng cao c·∫•p th√¥ng qua s·ª©c b·ªÅn v√† ƒë·ªô b·ªÅn c·ªßa s·∫£n ph·∫©m<br>
                        - T∆∞ v·∫•n chuy√™n nghi·ªáp ng√†y ƒë√™m b√°c sƒ©, b·ªánh nh√¢n v√† c·ªông ƒë·ªìng trong vi·ªác tr√¨nh chƒÉm s√≥c s·ª©c kh·ªèe b·ªÅn v·ªØng</p>
                    </div>
                    <div class="info-item">
                        <div class="info-icon">
                            <div class="icon-circle">
                                <span>üèÜ</span>
                            </div>
                        </div>
                        <h3>GI√Å TR·ªä C·ªêT L√ïI</h3>
                        <p>ƒê·ª©c Ph∆∞∆°ng cam k·∫øt lu√¥n ƒë·∫∑t l·ª£i √≠ch c·ªßa kh√°ch h√†ng l√™n h√†ng ƒë·∫ßu. Ch√∫ng t√¥i kh√¥ng ng·ª´ng n·ªó l·ª±c ƒëem ƒë·∫øn s·ª± m·ªü r·ªông s·∫£n ph·∫©m v√† n√¢ng cao ch·∫•t l∆∞·ª£ng d·ªãch v·ª• t∆∞ v·∫•n, h·ªó tr·ª£ kh√°ch h√†ng l√≤ng v√† tin t∆∞·ªüng c·ªßa Qu√Ω kh√°ch h√†ng ch√≠nh l√† ƒë·ªông l·ª±c l·ªõn nh·∫•t ƒë·ªÉ ƒê·ª©c Ph∆∞∆°ng ti·∫øp t·ª•c ph√°t tri·ªÉn.</p>
                    </div>
                </div>
                <div class="partners-wrapper">
                    <div class="partners-layout">
                        <div class="partners-left">
                            <h2>ƒê·ªêI T√ÅC C·ª¶A CH√öNG T√îI</h2>
                            <img src="hinh-chung-nhan/hinh-doitac.png" alt="ƒê·ªëi t√°c c·ªßa ch√∫ng t√¥i" onclick="openCertModal('hinh-chung-nhan/hinh-doitac.png', 'ƒê·ªëi t√°c c·ªßa ch√∫ng t√¥i')" style="cursor: pointer;">
                        </div>
                        <div class="partners-right">
                            <h2>NƒÇNG L·ª∞C ƒê·ªêI T√ÅC</h2>
                            <div class="certificate-carousel">
                                <div class="certificate-wrapper">
                                    <div class="certificate-track" id="certificateTrack">
                                        <div class="certificate-item" onclick="openCertModal('hinh-chung-nhan/chung-nhan1.png', 'Ch·ª©ng nh·∫≠n 1')">
                                            <img src="hinh-chung-nhan/chung-nhan1.png" alt="Ch·ª©ng nh·∫≠n 1">
                                        </div>
                                        <div class="certificate-item" onclick="openCertModal('hinh-chung-nhan/chung-nhan2.png', 'Ch·ª©ng nh·∫≠n 2')">
                                            <img src="hinh-chung-nhan/chung-nhan2.png" alt="Ch·ª©ng nh·∫≠n 2">
                                        </div>
                                        <div class="certificate-item" onclick="openCertModal('hinh-chung-nhan/chung-nhan3.png', 'Ch·ª©ng nh·∫≠n 3')">
                                            <img src="hinh-chung-nhan/chung-nhan3.png" alt="Ch·ª©ng nh·∫≠n 3">
                                        </div>
                                        <div class="certificate-item" onclick="openCertModal('hinh-chung-nhan/chung-nhan4.png', 'Ch·ª©ng nh·∫≠n 4')">
                                            <img src="hinh-chung-nhan/chung-nhan4.png" alt="Ch·ª©ng nh·∫≠n 4">
                                        </div>
                                        <div class="certificate-item" onclick="openCertModal('hinh-chung-nhan/chung-nhan5.png', 'Ch·ª©ng nh·∫≠n 5')">
                                            <img src="hinh-chung-nhan/chung-nhan5.png" alt="Ch·ª©ng nh·∫≠n 5">
                                        </div>
                                        <div class="certificate-item" onclick="openCertModal('hinh-chung-nhan/chung-nhan6.png', 'Ch·ª©ng nh·∫≠n 6')">
                                            <img src="hinh-chung-nhan/chung-nhan6.png" alt="Ch·ª©ng nh·∫≠n 6">
                                        </div>
                                        <div class="certificate-item" onclick="openCertModal('hinh-chung-nhan/chung-nhan7.png', 'Ch·ª©ng nh·∫≠n 7')">
                                            <img src="hinh-chung-nhan/chung-nhan7.png" alt="Ch·ª©ng nh·∫≠n 7">
                                        </div>
                                        <div class="certificate-item" onclick="openCertModal('hinh-chung-nhan/chung-nhan8.png', 'Ch·ª©ng nh·∫≠n 8')">
                                            <img src="hinh-chung-nhan/chung-nhan8.png" alt="Ch·ª©ng nh·∫≠n 8">
                                        </div>
                                        <div class="certificate-item" onclick="openCertModal('hinh-chung-nhan/chung-nhan9.png', 'Ch·ª©ng nh·∫≠n 9')">
                                            <img src="hinh-chung-nhan/chung-nhan9.png" alt="Ch·ª©ng nh·∫≠n 9">
                                        </div>
                                        <div class="certificate-item" onclick="openCertModal('hinh-chung-nhan/chung-nhan10.png', 'Ch·ª©ng nh·∫≠n 10')">
                                            <img src="hinh-chung-nhan/chung-nhan10.png" alt="Ch·ª©ng nh·∫≠n 10">
                                        </div>
                                        <div class="certificate-item" onclick="openCertModal('hinh-chung-nhan/chung-nhan11.png', 'Ch·ª©ng nh·∫≠n 11')">
                                            <img src="hinh-chung-nhan/chung-nhan11.png" alt="Ch·ª©ng nh·∫≠n 11">
                                        </div>
                                        <div class="certificate-item" onclick="openCertModal('hinh-chung-nhan/chung-nhan12.png', 'Ch·ª©ng nh·∫≠n 12')">
                                            <img src="hinh-chung-nhan/chung-nhan12.png" alt="Ch·ª©ng nh·∫≠n 12">
                                        </div>
                                        <div class="certificate-item" onclick="openCertModal('hinh-chung-nhan/chung-nhan13.png', 'Ch·ª©ng nh·∫≠n 13')">
                                            <img src="hinh-chung-nhan/chung-nhan13.png" alt="Ch·ª©ng nh·∫≠n 13">
                                        </div>
                                        <div class="certificate-item" onclick="openCertModal('hinh-chung-nhan/chung-nhan14.png', 'Ch·ª©ng nh·∫≠n 14')">
                                            <img src="hinh-chung-nhan/chung-nhan14.png" alt="Ch·ª©ng nh·∫≠n 14">
                                        </div>
                                    </div>
                                </div>
                                <button class="cert-btn prev-cert-btn" onclick="prevCertificate()">‚Äπ</button>
                                <button class="cert-btn next-cert-btn" onclick="nextCertificate()">‚Ä∫</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    </section>

    <section class="products-section reveal">
        <div class="container">
            <h2>S·∫¢N PH·∫®M N·ªîI B·∫¨T</h2>
            <div class="featured-products-wrapper">
                <div class="product-grid" id="featuredProductsGrid">
                <!-- Loading skeleton -->
                <div class="product-card skeleton-item">
                    <div class="skeleton-img"></div>
                    <div class="skeleton-text"></div>
                    <div class="skeleton-text short"></div>
                    <div class="skeleton-text"></div>
                </div>
                <div class="product-card skeleton-item">
                    <div class="skeleton-img"></div>
                    <div class="skeleton-text"></div>
                    <div class="skeleton-text short"></div>
                    <div class="skeleton-text"></div>
                </div>
                <div class="product-card skeleton-item">
                    <div class="skeleton-img"></div>
                    <div class="skeleton-text"></div>
                    <div class="skeleton-text short"></div>
                    <div class="skeleton-text"></div>
                </div>
                <div class="product-card skeleton-item">
                    <div class="skeleton-img"></div>
                    <div class="skeleton-text"></div>
                    <div class="skeleton-text short"></div>
                    <div class="skeleton-text"></div>
                </div>
                <div class="product-card skeleton-item">
                    <div class="skeleton-img"></div>
                    <div class="skeleton-text"></div>
                    <div class="skeleton-text short"></div>
                    <div class="skeleton-text"></div>
                </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Carousel gi·ªëng FPTShop -->
    <section class="mini-banners-section reveal">
        <div class="container">
            <div class="carousel-container">
                <div class="carousel-wrapper">
                    <div class="carousel-track" id="carouselTrack">
                        <div class="carousel-item" onclick="openCertModal('hinh-mau/hinh-sanpham-1.png', 'S·∫£n ph·∫©m 1')">
                            <img src="hinh-mau/hinh-sanpham-1.png" alt="S·∫£n ph·∫©m 1">
                        </div>
                        <div class="carousel-item" onclick="openCertModal('hinh-mau/hinh-sanpham-2.png', 'S·∫£n ph·∫©m 2')">
                            <img src="hinh-mau/hinh-sanpham-2.png" alt="S·∫£n ph·∫©m 2">
                        </div>
                        <div class="carousel-item" onclick="openCertModal('hinh-mau/hinh-sanpham-3.png', 'S·∫£n ph·∫©m 3')">
                            <img src="hinh-mau/hinh-sanpham-3.png" alt="S·∫£n ph·∫©m 3">
                        </div>
                        <div class="carousel-item" onclick="openCertModal('hinh-mau/hinh-sanpham-4.png', 'S·∫£n ph·∫©m 4')">
                            <img src="hinh-mau/hinh-sanpham-4.png" alt="S·∫£n ph·∫©m 4">
                        </div>
                        <div class="carousel-item" onclick="openCertModal('hinh-mau/hinh-sanpham-5.png', 'S·∫£n ph·∫©m 5')">
                            <img src="hinh-mau/hinh-sanpham-5.png" alt="S·∫£n ph·∫©m 5">
                        </div>
                        <div class="carousel-item" onclick="openCertModal('hinh-mau/hinh-sanpham-6.png', 'S·∫£n ph·∫©m 6')">
                            <img src="hinh-mau/hinh-sanpham-6.png" alt="S·∫£n ph·∫©m 6">
                        </div>
                        <div class="carousel-item" onclick="openCertModal('hinh-mau/hinh-sanpham-7.png', 'S·∫£n ph·∫©m 7')">
                            <img src="hinh-mau/hinh-sanpham-7.png" alt="S·∫£n ph·∫©m 7">
                        </div>
                        <div class="carousel-item" onclick="openCertModal('hinh-mau/hinh-sanpham-8.png', 'S·∫£n ph·∫©m 8')">
                            <img src="hinh-mau/hinh-sanpham-8.png" alt="S·∫£n ph·∫©m 8">
                        </div>
                    </div>
                </div>
                <button class="carousel-btn prev-btn" onclick="prevCarousel()">‚Äπ</button>
                <button class="carousel-btn next-btn" onclick="nextCarousel()">‚Ä∫</button>
            </div>
        </div>
    </section>
    <section class="projects-section reveal">
        <div class="container">
            <h2>D·ª∞ √ÅN TI√äU BI·ªÇU</h2>
            <div class="projects-form">
                <div class="projects-slideshow">
                    <div class="project-track" id="projectTrack">
                        <div class="project-slide">
                            <div class="project-item" onclick="openCertModal('hinh-du-an/du-an1.png', 'D·ª± √°n 1')">
                                <img src="hinh-du-an/du-an1.png" alt="D·ª± √°n 1">
                            </div>
                            <div class="project-item" onclick="openCertModal('hinh-du-an/du-an2.png', 'D·ª± √°n 2')">
                                <img src="hinh-du-an/du-an2.png" alt="D·ª± √°n 2">
                            </div>
                        </div>
                        <div class="project-slide">
                            <div class="project-item" onclick="openCertModal('hinh-du-an/du-an3.png', 'D·ª± √°n 3')">
                                <img src="hinh-du-an/du-an3.png" alt="D·ª± √°n 3">
                            </div>
                            <div class="project-item" onclick="openCertModal('hinh-du-an/du-an4.png', 'D·ª± √°n 4')">
                                <img src="hinh-du-an/du-an4.png" alt="D·ª± √°n 4">
                            </div>
                        </div>
                        <div class="project-slide">
                            <div class="project-item" onclick="openCertModal('hinh-du-an/du-an5.png', 'D·ª± √°n 5')">
                                <img src="hinh-du-an/du-an5.png" alt="D·ª± √°n 5">
                            </div>
                            <div class="project-item" onclick="openCertModal('hinh-du-an/du-an6.png', 'D·ª± √°n 6')">
                                <img src="hinh-du-an/du-an6.png" alt="D·ª± √°n 6">
                            </div>
                        </div>
                    </div>
                </div>
                <button type="button" class="project-nav-btn project-prev-btn" onclick="prevProjectSlide()">‚Äπ</button>
                <button type="button" class="project-nav-btn project-next-btn" onclick="nextProjectSlide()">‚Ä∫</button>
                <div class="project-indicators">
                    <span class="project-dot active" onclick="currentProjectSlide(1)"></span>
                    <span class="project-dot" onclick="currentProjectSlide(2)"></span>
                    <span class="project-dot" onclick="currentProjectSlide(3)"></span>
                </div>
            </div>
        </div>
    </section>
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeLoginForm()">&times;</span>
            <div class="login-container">
                <div class="login-header">
                    <div class="service-icons">
                        <div class="fpt-icon">TaJerMy</div>
                        <div class="arrow">‚Üí</div>
                        <div class="shop-icon">üõçÔ∏è</div>
                    </div>
                    <h2>T√†i kho·∫£n s·ª≠ d·ª•ng d·ªãch v·ª• <span class="fpt-logo">TaJerMy</span></h2>
                </div>
                
                <div class="login-form">
                    <!-- Step 1: Phone -->
                    <div id="loginStep1">
                        <label>T√™n ƒëƒÉng nh·∫≠p / S·ªë ƒëi·ªán tho·∫°i <span class="required">*</span></label>
                        <input type="text" id="loginInput" placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p ho·∫∑c s·ªë ƒëi·ªán tho·∫°i" class="login-input">
                        <button class="continue-btn" onclick="handleLoginStep1()">Ti·∫øp t·ª•c</button>
                    </div>

                    <!-- Step 2: Password -->
                    <div id="loginStep2" style="display: none;">
                        <div class="login-header-step2"><button class="back-btn" onclick="backToStep1()">‚Üê</button> Nh·∫≠p m·∫≠t kh·∫©u</div>
                        <label>M·∫≠t kh·∫©u <span class="required">*</span></label>
                        <input type="password" id="loginPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" class="login-input">
                        <button type="button" class="continue-btn" onclick="handleLoginStep2()">ƒêƒÉng nh·∫≠p</button>
                    </div>

                    <!-- Register Step -->
                    <div id="registerStep" style="display: none;">
                        <span onclick="backToLogin()" style="position: absolute; top: 10px; left: 20px; font-size: 30px; font-weight: bold; color: #aaa; cursor: pointer; z-index: 10;">‚Üê</span>
                        <div style="text-align: center; font-weight: bold; font-size: 18px; margin-bottom: 15px; margin-top: -10px;">ƒêƒÉng k√Ω t√†i kho·∫£n</div>
                        
                        <label>T√™n ƒëƒÉng nh·∫≠p <span class="required">*</span></label>
                        <input type="text" id="regUsername" class="login-input" placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p" style="margin-bottom: 5px;">
                        
                        <label>S·ªë ƒëi·ªán tho·∫°i <span class="required">*</span></label>
                        <input type="text" id="regPhone" class="login-input" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i" style="margin-bottom: 5px;">
                        
                        <label>Email <span class="required">*</span></label>
                        <input type="email" id="regGmail" class="login-input" placeholder="Nh·∫≠p email" style="margin-bottom: 5px;">
                        
                        <label>M·∫≠t kh·∫©u <span class="required">*</span></label>
                        <input type="password" id="regPass" class="login-input" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" style="margin-bottom: 5px;">
                        
                        <label>M√£ x√°c nh·∫≠n <span class="required">*</span></label>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <input type="text" id="regCode" class="login-input" placeholder="Nh·∫≠p m√£ x√°c nh·∫≠n" style="flex: 1; margin-bottom: 0;">
                            <button type="button" class="continue-btn" onclick="sendVerificationCode()" style="width: auto; margin: 0; padding: 0 15px;">Nh·∫≠n m√£</button>
                        </div>
                        
                        <button class="continue-btn" onclick="handleRegister()">ƒêƒÉng k√Ω</button>
                        <div id="registerMessage" style="text-align: center; margin-top: 2px; font-weight: bold;"></div>
                    </div>

                    <p class="terms-text">
                        B·∫±ng c√°ch ti·∫øp t·ª•c, b·∫°n ƒë·ªìng √Ω v·ªõi 
                        <a href="#" class="link">ƒêi·ªÅu kho·∫£n</a> v√† 
                        <a href="#" class="link">Ch√≠nh s√°ch</a> b·∫£o m·∫≠t c·ªßa TaJerMy
                    </p>
                    
                    <div class="divider">
                        <span>Ho·∫∑c ƒëƒÉng nh·∫≠p b·∫±ng</span>
                    </div>      
                    <div class="social-login">
                        <button class="social-btn apple-btn" onclick="showRegisterForm()">ƒêƒÉng k√Ω</button>
                        <button class="social-btn google-btn">
                            <img src="hinh-anh/google-logo.png" alt="Google" class="google-icon">
                        </button>
                        <button class="social-btn facebook-btn">
                            <img src="hinh-anh/fb-logo.png" alt="Facebook" class="facebook-icon">
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Check session on load
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
        });

        let isLoggedIn = false;

        function checkLoginStatus() {
            fetch('/check_session.php', { credentials: 'include' })
                .then(response => response.json())
                .then(data => {
                    const accountDropdown = document.querySelector('.account-dropdown');
                    if (data.logged_in) {
                        isLoggedIn = true;
                        sessionStorage.setItem('sessionLoggedIn', 'true');
                        if (accountDropdown) accountDropdown.classList.add('logged-in');
                        
                        const usernameDisplay = document.getElementById('usernameDisplay');
                        if (usernameDisplay) {
                            usernameDisplay.innerText = data.username;
                            usernameDisplay.style.display = 'block';
                        }
                        // Hide login modal if open
                        closeLoginForm();
                    } else {
                        isLoggedIn = false;
                        sessionStorage.removeItem('sessionLoggedIn');
                        if (accountDropdown) accountDropdown.classList.remove('logged-in');
                        
                        const usernameDisplay = document.getElementById('usernameDisplay');
                        if (usernameDisplay) {
                            usernameDisplay.style.display = 'none';
                        }
                    }
                })
                .catch(err => console.error('Session check failed', err));
        }

        function handleAccountClick(event) {
            event.stopPropagation(); // NgƒÉn event bubble l√™n c√°c ph·∫ßn t·ª≠ cha
            
            const accountMenu = document.getElementById('accountMenu');
            
            // Ki·ªÉm tra tr·∫°ng th√°i ƒëƒÉng nh·∫≠p
            if (!isLoggedIn) {
                // Ch∆∞a ƒëƒÉng nh·∫≠p ‚Üí hi·ªÉn th·ªã form ƒëƒÉng nh·∫≠p
                toggleLoginForm();
            } else {
                // ƒê√£ ƒëƒÉng nh·∫≠p ‚Üí toggle hi·ªÉn th·ªã menu
                if (accountMenu.style.display === 'block') {
                    accountMenu.style.display = 'none';
                } else {
                    accountMenu.style.display = 'block';
                }
            }
        }

        // ƒê√≥ng menu khi click ra ngo√†i
        document.addEventListener('click', function(event) {
            const accountDropdown = document.querySelector('.account-dropdown');
            const accountMenu = document.getElementById('accountMenu');
            
            if (accountDropdown && !accountDropdown.contains(event.target)) {
                accountMenu.style.display = 'none';
            }
        });

        function handleLoginStep1() {
            const inputVal = document.getElementById('loginInput').value;
            if (!inputVal) {
                alert('Vui l√≤ng nh·∫≠p t√™n ƒëƒÉng nh·∫≠p ho·∫∑c s·ªë ƒëi·ªán tho·∫°i!');
                return;
            }
            // Switch to step 2
            document.getElementById('loginStep1').style.display = 'none';
            document.getElementById('loginStep2').style.display = 'block';
        }

        function backToStep1() {
            document.getElementById('loginStep1').style.display = 'block';
            document.getElementById('loginStep2').style.display = 'none';
        }

        function handleLoginStep2() {
            const inputVal = document.getElementById('loginInput').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!password) {
                alert('Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u!');
                return;
            }

            console.log('B·∫Øt ƒë·∫ßu ƒëƒÉng nh·∫≠p...', { username: inputVal });

            fetch('login.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify({ username: inputVal, password: password })
            })
            .then(async response => {
                console.log('Response status:', response.status);
                const raw = await response.text();
                let data;
                try {
                    data = raw ? JSON.parse(raw) : {};
                } catch (err) {
                    console.error('JSON parse failed, raw:', raw);
                    throw new Error('Ph·∫£n h·ªìi m√°y ch·ªß kh√¥ng h·ª£p l·ªá.');
                }

                if (!response.ok || data.status === 'error') {
                    throw new Error(data.message || 'ƒêƒÉng nh·∫≠p th·∫•t b·∫°i.');
                }
                return data;
            })
            .then(data => {
                console.log('D·ªØ li·ªáu nh·∫≠n ƒë∆∞·ª£c:', data);
                // ƒê√≥ng modal ƒëƒÉng nh·∫≠p tr∆∞·ªõc
                closeLoginForm();
                // L∆∞u position v√†o localStorage
                if (data.position) {
                    localStorage.setItem('userPosition', data.position);
                }
                
                // Chuy·ªÉn h∆∞·ªõng ho·∫∑c reload
                setTimeout(() => {
                    if (data.redirect) {
                        if (data.redirect === 'index.html') {
                            window.location.reload(); // Reload trang hi·ªán t·∫°i
                        } else {
                            window.location.href = data.redirect; // Chuy·ªÉn trang kh√°c
                        }
                    } else {
                        window.location.reload();
                    }
                }, 300);
            })
            .catch(error => {
                console.error('L·ªói ƒëƒÉng nh·∫≠p:', error);
                alert('C√≥ l·ªói x·∫£y ra khi ƒëƒÉng nh·∫≠p: ' + error.message);
            });
        }

        function handleLogout() {
            fetch('logout.php', { credentials: 'include' })
                .then(() => {
                    sessionStorage.removeItem('sessionLoggedIn');
                    window.location.reload();
                });
        }

        function showRegisterForm() {
            // ·∫®n c√°c ph·∫ßn c·ªßa form ƒëƒÉng nh·∫≠p
            document.getElementById('loginStep1').style.display = 'none';
            document.getElementById('loginStep2').style.display = 'none';
            document.querySelector('.terms-text').style.display = 'none';
            document.querySelector('.divider').style.display = 'none';
            document.querySelector('.social-login').style.display = 'none';
            
            // Hi·ªán form ƒëƒÉng k√Ω
            document.getElementById('registerStep').style.display = 'block';
            
            // Reset form ƒëƒÉng k√Ω
            document.getElementById('registerMessage').innerText = '';
            document.getElementById('regUsername').value = '';
            document.getElementById('regPhone').value = '';
            document.getElementById('regGmail').value = '';
            document.getElementById('regPass').value = '';
            if(document.getElementById('regCode')) document.getElementById('regCode').value = '';
        }

        function backToLogin() {
            document.getElementById('registerStep').style.display = 'none';
            document.getElementById('loginStep1').style.display = 'block';
            document.querySelector('.terms-text').style.display = 'block';
            document.querySelector('.divider').style.display = 'block';
            document.querySelector('.social-login').style.display = 'flex';
        }

        function sendVerificationCode() {
            const gmail = document.getElementById('regGmail').value;
            if (!gmail) {
                alert('Vui l√≤ng nh·∫≠p email ƒë·ªÉ nh·∫≠n m√£!');
                return;
            }
            
            const formData = new FormData();
            formData.append('send', 'true');
            formData.append('gmail', gmail);

            fetch('/xacnhangamil.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.text())
            .then(data => {
                alert(data);
            })
            .catch(error => {
                console.error('Error:', error);
                alert('C√≥ l·ªói x·∫£y ra khi g·ª≠i m√£.');
            });
        }

        function handleRegister() {
            const user = document.getElementById('regUsername').value;
            const phone = document.getElementById('regPhone').value;
            const gmail = document.getElementById('regGmail').value;
            const pass = document.getElementById('regPass').value;
            const code = document.getElementById('regCode').value;
            const msgDiv = document.getElementById('registerMessage');

            if (!user || !phone || !gmail || !pass || !code) {
                msgDiv.style.color = 'red';
                msgDiv.innerText = 'Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin v√† m√£ x√°c nh·∫≠n!';
                return;
            }

            // Verify code first
            const formData = new FormData();
            formData.append('code', code);

            fetch('/check_code.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    // Code correct, proceed to register
                    fetch('/register.php', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username: user, phone: phone, gmail: gmail, password: pass })
                    })
                    .then(response => response.text())
                    .then(text => {
                        let regData;
                        try {
                            regData = JSON.parse(text);
                        } catch (e) {
                            console.error('Register response not JSON:', text);
                            msgDiv.style.color = 'red';
                            msgDiv.innerText = text || 'C√≥ l·ªói x·∫£y ra, vui l√≤ng th·ª≠ l·∫°i.';
                            return;
                        }
                        if (regData.status === 'success') {
                            msgDiv.style.color = '#4CAF50';
                            msgDiv.innerText = 'ƒêƒÉng k√Ω th√†nh c√¥ng!';
                        } else {
                            msgDiv.style.color = 'red';
                            msgDiv.innerText = regData.message || 'C√≥ l·ªói x·∫£y ra, vui l√≤ng th·ª≠ l·∫°i.';
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        msgDiv.style.color = 'red';
                        msgDiv.innerText = 'C√≥ l·ªói x·∫£y ra, vui l√≤ng th·ª≠ l·∫°i.';
                    });
                } else {
                    msgDiv.style.color = 'red';
                    msgDiv.innerText = 'Sai m√£ x√°c nh·∫≠n';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                msgDiv.style.color = 'red';
                msgDiv.innerText = 'L·ªói ki·ªÉm tra m√£ x√°c nh·∫≠n.';
            });
        }

        function toggleRegisterPassword(btn) {
            const passwordInput = document.getElementById('regPass');
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                btn.textContent = 'üôà'; // Icon ·∫©n
            } else {
                passwordInput.type = 'password';
                btn.textContent = 'üëÅÔ∏è'; // Icon hi·ªán
            }
        }

        function toggleLoginForm() {
            document.getElementById('loginModal').style.display = 'block';
            // ƒê·∫£m b·∫£o quay v·ªÅ m√†n h√¨nh ƒëƒÉng nh·∫≠p m·∫∑c ƒë·ªãnh khi m·ªü modal
            if (typeof backToLogin === 'function') backToLogin();
            if (typeof backToStep1 === 'function') backToStep1(); 
            if(document.getElementById('loginInput')) document.getElementById('loginInput').value = '';
            if(document.getElementById('loginPassword')) document.getElementById('loginPassword').value = '';
        }
        
        function closeLoginForm() {
            document.getElementById('loginModal').style.display = 'none';
        }
        
        window.onclick = function(event) {
            var modal = document.getElementById('loginModal');
            var certModal = document.getElementById('certModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
            if (event.target == certModal) {
                certModal.style.display = 'none';
            }
        }
        
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide');
        
        function showSlide(index) {
            slides.forEach(slide => slide.classList.remove('active'));
            slides[index].classList.add('active');
        }
        
        function nextSlide() {
            currentSlide = (currentSlide + 1) % slides.length;
            showSlide(currentSlide);
        }
        
        function prevSlide() {
            currentSlide = (currentSlide - 1 + slides.length) % slides.length;
            showSlide(currentSlide);
        }
        
        setInterval(nextSlide, 5000);
        
        // Project slideshow ping-pong logic
        let currentProjectSlideIndex = 0;
        let projectDirection = 1;
        let projectAutoSlideInterval;
        const projectTrack = document.getElementById('projectTrack');
        const projectSlides = document.querySelectorAll('.project-slide');
        const projectDots = document.querySelectorAll('.project-dot');
        const maxProjectIndex = projectSlides.length - 1;
        
        function updateProjectSlide() {
            const translateX = -(currentProjectSlideIndex * 33.333);
            projectTrack.style.transform = `translateX(${translateX}%)`;
            updateProjectButtons();
            updateProjectDots();
        }
        
        function updateProjectDots() {
            projectDots.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentProjectSlideIndex);
            });
        }
        
        function updateProjectButtons() {
            const prevBtn = document.querySelector('.project-prev-btn');
            const nextBtn = document.querySelector('.project-next-btn');
            
            if (currentProjectSlideIndex === 0 && projectDirection === 1) {
                prevBtn.style.opacity = '0';
                prevBtn.style.pointerEvents = 'none';
            } else {
                prevBtn.style.opacity = '1';
                prevBtn.style.pointerEvents = 'auto';
            }
            
            if (currentProjectSlideIndex === maxProjectIndex && projectDirection === -1) {
                nextBtn.style.opacity = '0';
                nextBtn.style.pointerEvents = 'none';
            } else {
                nextBtn.style.opacity = '1';
                nextBtn.style.pointerEvents = 'auto';
            }
        }
        
        function autoProjectSlide() {
            if (currentProjectSlideIndex >= maxProjectIndex) {
                projectDirection = -1;
            } else if (currentProjectSlideIndex <= 0) {
                projectDirection = 1;
            }
            
            currentProjectSlideIndex += projectDirection;
            updateProjectSlide();
        }
        
        function nextProjectSlide() {
            clearInterval(projectAutoSlideInterval);
            
            if (currentProjectSlideIndex < maxProjectIndex) {
                currentProjectSlideIndex++;
                projectDirection = 1;
            } else {
                projectDirection = -1;
                currentProjectSlideIndex--;
            }
            
            updateProjectSlide();
            projectAutoSlideInterval = setInterval(autoProjectSlide, 3000);
        }
        
        function prevProjectSlide() {
            clearInterval(projectAutoSlideInterval);
            
            if (currentProjectSlideIndex > 0) {
                currentProjectSlideIndex--;
                projectDirection = -1;
            } else {
                projectDirection = 1;
                currentProjectSlideIndex++;
            }
            
            updateProjectSlide();
            projectAutoSlideInterval = setInterval(autoProjectSlide, 3000);
        }
        
        function currentProjectSlide(n) {
            clearInterval(projectAutoSlideInterval);
            currentProjectSlideIndex = n - 1;
            projectDirection = 1;
            updateProjectSlide();
            projectAutoSlideInterval = setInterval(autoProjectSlide, 3000);
        }
        
        updateProjectSlide();
        projectAutoSlideInterval = setInterval(autoProjectSlide, 3000);
        
        // Carousel ping-pong logic
        let currentCarouselIndex = 0;
        let direction = 1;
        let autoSlideInterval;
        const track = document.getElementById('carouselTrack');
        const carouselItems = document.querySelectorAll('.carousel-item');
        const totalItems = carouselItems.length;
        const slidesToShow = 3;
        const maxIndex = totalItems - slidesToShow;
        
        function updateCarousel() {
            const translateX = -(currentCarouselIndex * (100 / slidesToShow));
            track.style.transform = `translateX(${translateX}%)`;
            updateCarouselButtons();
        }
        
        function updateCarouselButtons() {
            const prevBtn = document.querySelector('.carousel-container .prev-btn');
            const nextBtn = document.querySelector('.carousel-container .next-btn');
            
            if (currentCarouselIndex === 0 && direction === 1) {
                prevBtn.style.opacity = '0';
                prevBtn.style.pointerEvents = 'none';
            } else {
                prevBtn.style.opacity = '1';
                prevBtn.style.pointerEvents = 'auto';
            }
            
            if (currentCarouselIndex === maxIndex && direction === -1) {
                nextBtn.style.opacity = '0';
                nextBtn.style.pointerEvents = 'none';
            } else {
                nextBtn.style.opacity = '1';
                nextBtn.style.pointerEvents = 'auto';
            }
        }
        
        function autoSlide() {
            if (currentCarouselIndex >= maxIndex) {
                direction = -1;
            } else if (currentCarouselIndex <= 0) {
                direction = 1;
            }
            
            currentCarouselIndex += direction;
            updateCarousel();
        }
        
        function nextCarousel() {
            clearInterval(autoSlideInterval);
            
            if (currentCarouselIndex < maxIndex) {
                currentCarouselIndex++;
                direction = 1;
            } else {
                direction = -1;
                currentCarouselIndex--;
            }
            
            updateCarousel();
            autoSlideInterval = setInterval(autoSlide, 3000);
        }
        
        function prevCarousel() {
            clearInterval(autoSlideInterval);
            
            if (currentCarouselIndex > 0) {
                currentCarouselIndex--;
                direction = -1;
            } else {
                direction = 1;
                currentCarouselIndex++;
            }
            
            updateCarousel();
            autoSlideInterval = setInterval(autoSlide, 3000);
        }
        
        updateCarousel();
        autoSlideInterval = setInterval(autoSlide, 3000);
        
        // Certificate carousel ping-pong logic
        let currentCertIndex = 0;
        let certDirection = 1;
        let certAutoSlideInterval;
        const certTrack = document.getElementById('certificateTrack');
        const certItems = document.querySelectorAll('.certificate-item');
        const maxCertIndex = certItems.length - 1;
        
        function updateCertificate() {
            const translateX = -(currentCertIndex * 100);
            certTrack.style.transform = `translateX(${translateX}%)`;
            updateCertButtons();
        }
        
        function updateCertButtons() {
            const prevBtn = document.querySelector('.prev-cert-btn');
            const nextBtn = document.querySelector('.next-cert-btn');
            
            if (currentCertIndex === 0 && certDirection === 1) {
                prevBtn.style.opacity = '0';
                prevBtn.style.pointerEvents = 'none';
            } else {
                prevBtn.style.opacity = '1';
                prevBtn.style.pointerEvents = 'auto';
            }
            
            if (currentCertIndex === maxCertIndex && certDirection === -1) {
                nextBtn.style.opacity = '0';
                nextBtn.style.pointerEvents = 'none';
            } else {
                nextBtn.style.opacity = '1';
                nextBtn.style.pointerEvents = 'auto';
            }
        }
        
        function autoCertSlide() {
            if (currentCertIndex >= maxCertIndex) {
                certDirection = -1;
            } else if (currentCertIndex <= 0) {
                certDirection = 1;
            }
            
            currentCertIndex += certDirection;
            updateCertificate();
        }
        
        function nextCertificate() {
            clearInterval(certAutoSlideInterval);
            
            if (currentCertIndex < maxCertIndex) {
                currentCertIndex++;
                certDirection = 1;
            } else {
                certDirection = -1;
                currentCertIndex--;
            }
            
            updateCertificate();
            certAutoSlideInterval = setInterval(autoCertSlide, 3000);
        }
        
        function prevCertificate() {
            clearInterval(certAutoSlideInterval);
            
            if (currentCertIndex > 0) {
                currentCertIndex--;
                certDirection = -1;
            } else {
                certDirection = 1;
                currentCertIndex++;
            }
            
            updateCertificate();
            certAutoSlideInterval = setInterval(autoCertSlide, 3000);
        }
        
        updateCertificate();
        certAutoSlideInterval = setInterval(autoCertSlide, 3000);
        
                // Category data for dropdown hover
               // Category data for dropdown hover
        const categoryData = {
            'Gi∆∞·ªùng': ['Gi∆∞·ªùng b·ªánh c∆° b·∫£n', 'Gi∆∞·ªùng chuy√™n d·ª•ng (ICU, s·∫£n khoa)', 'Gi∆∞·ªùng ƒëi·ªÅu ch·ªânh ƒë·ªô cao/ t∆∞ th·∫ø (gi∆∞·ªùng ƒëi·ªán)', 'Gi∆∞·ªùng chƒÉm s√≥c t·∫°i nh√†'],
            'Xe lƒÉn': ['Xe lƒÉn tay (ng∆∞·ªùi d√πng t·ª± ƒë·∫©y)', 'Xe lƒÉn ƒë·∫©y sau (ng∆∞·ªùi chƒÉm s√≥c ƒë·∫©y)', 'Xe lƒÉn ƒëi·ªán', 'Xe lƒÉn th·ªÉ thao', 'Xe lƒÉn g·∫•p g·ªçn/ di chuy·ªÉn', 'Xe lƒÉn l√™n xu·ªëng c·∫ßu thang'],
            'Xe Scooter ƒëi·ªán': ['Lo·∫°i di chuy·ªÉn trong nh√†/ ƒë∆∞·ªùng b·∫±ng ph·∫≥ng', 'Lo·∫°i ƒë·ªãa h√¨nh (b√°nh l·ªõn, ƒëi ƒë∆∞·ªùng d√†i)', 'Lo·∫°i g·∫•p g·ªçn/ th√°o r·ªùi'],
            'BƒÉng ca': ['BƒÉng ca c·∫•p c·ª©u (c·ªë ƒë·ªãnh)', 'BƒÉng ca ƒë·∫©y (c√≥ b√°nh xe)', 'BƒÉng ca g·∫•p (v·∫≠n chuy·ªÉn)', 'BƒÉng ca chuy√™n d·ª•ng (ch·ªëng s·ªëc, ch·ª•p X-Quang)', 'ƒê·ªám v·∫≠n chuy·ªÉn'],
            'T·ªß': ['T·ªß ƒë·ª±ng thu·ªëc', 'T·ªß ƒë·ª±ng h·ªì s∆° b·ªánh √°n', 'T·ªß tr∆∞ng b√†y/ l∆∞u tr·ªØ d·ª•ng c·ª•', 'T·ªß ƒë·∫ßu gi∆∞·ªùng b·ªánh'],
            'M√°y t·∫°o oxy': ['M√°y t·∫°o oxy t·∫°i nh√† (lo·∫°i l·ªõn)', 'M√°y t·∫°o oxy x√°ch tay/ di ƒë·ªông', 'M√°y t·∫°o oxy d√≤ng cao (cho tr·ªã li·ªáu ƒë·∫∑c bi·ªát)'],
            'M√°y ƒëo': ['M√°y ƒëo huy·∫øt √°p', 'M√°y ƒëo ƒë∆∞·ªùng huy·∫øt', 'M√°y ƒëo n·ªìng ƒë·ªô oxy trong m√°u (SpO2)', 'M√°y ƒëo th√¢n nhi·ªát', 'M√°y ƒëo tim (ECG di ƒë·ªông)', 'C√¢n s·ª©c kh·ªèe (c∆°/ ƒëi·ªán t·ª≠)'],
            'M√°y x√¥ng': ['M√°y x√¥ng kh√≠ dung ki·ªÉu n√©n', 'M√°y x√¥ng si√™u √¢m', 'M√°y x√¥ng m√†ng (mesh)'],
            'M√°y h√∫t d·ªãch': ['M√°y h√∫t d·ªãch ƒë·ªÉ b√†n/ c·ªë ƒë·ªãnh', 'M√°y h√∫t d·ªãch x√°ch tay/ di ƒë·ªông'],
            'M√°y massage': ['M√°y massage c·∫ßm tay (gi·∫£m ƒëau c∆°)', 'ƒêai/ gh·∫ø massage to√†n th√¢n', 'M√°y massage ch√¢n (xoa b√≥p, l∆∞u th√¥ng m√°u)', 'Thi·∫øt b·ªã massage tr·ªã li·ªáu (nh∆∞ s√≥ng si√™u √¢m, laser c·∫•p th·∫•p)'],
            'Thi·∫øt b·ªã t·∫≠p': ['Thi·∫øt b·ªã t·∫≠p v·∫≠n ƒë·ªông th·ª• ƒë·ªông (CPM)', 'Thi·∫øt b·ªã t·∫≠p ƒëi/ thƒÉng b·∫±ng', 'Thi·∫øt b·ªã t·∫≠p ph·ª•c h·ªìi ch·ª©c nƒÉng tay/ ch√¢n', 'M√°y t·∫≠p th·ªÉ d·ª•c chuy√™n bi·ªát (xe ƒë·∫°p, treadmill cho ph·ª•c h·ªìi)', 'D·ª•ng c·ª• t·∫≠p tr·ªã li·ªáu (b√≥ng, d√¢y kh√°ng l·ª±c, t·∫° tay nh·∫π)'],
            'N·ªám': ['N·ªám ch·ªëng lo√©t (h∆°i, x·ªëp, gel)', 'N·ªám b·ªánh vi·ªán ti√™u chu·∫©n', 'N·ªám n√¢ng ƒë·ª° c∆° th·ªÉ (memory foam, cao su)'],
            'D·ª•ng c·ª• h·ªó tr·ª£': ['H·ªó tr·ª£ di chuy·ªÉn (khung t·∫≠p ƒëi, g·∫≠y ch·ªëng, n·∫°ng)', 'H·ªó tr·ª£ v·ªá sinh (b√¥ v·ªá sinh, b·ªìn c·∫ßu n√¢ng)', 'H·ªó tr·ª£ t·∫Øm (gh·∫ø t·∫Øm, th·∫£m ch·ªëng tr∆∞·ª£t)', 'H·ªó tr·ª£ m·∫∑c qu·∫ßn √°o', 'H·ªó tr·ª£ ƒÉn u·ªëng (th√¨a, ƒë≈©a, tay c·∫ßm ch·ªânh)'],
            'Thi·∫øt b·ªã y t·∫ø kh√°c': ['ƒê√®n kh√°m b·ªánh', 'M√°y kh·ª≠ rung tim (AED)', 'B∆°m ti√™m ƒëi·ªán', 'H·ªôp ƒë·ª±ng d·ª•ng c·ª• v√¥ tr√πng', 'V√† r·∫•t nhi·ªÅu thi·∫øt b·ªã chuy√™n s√¢u kh√°c']
        };
        
        // H√†m hi·ªÉn th·ªã chi ti·∫øt lo·∫°i s·∫£n ph·∫©m theo nh√≥m
        function renderCategoryDetail(categoryName) {
            const categoryDetail = document.getElementById('categoryDetail');
            if (!categoryData[categoryName] || !categoryDetail) return;

            const items = categoryData[categoryName];
            const itemsPerColumn = Math.ceil(items.length / 3) || 1;

            let columns = ['', '', ''];
            items.forEach((item, index) => {
                const columnIndex = Math.min(2, Math.floor(index / itemsPerColumn));
                columns[columnIndex] += `<li class="detail-item" data-group="${categoryName}" data-type="${item}">${item}</li>`;
            });

            categoryDetail.innerHTML = `
                <div class="detail-column">
                    <h4>${categoryName}</h4>
                    <ul>${columns[0]}</ul>
                </div>
                <div class="detail-column">
                    <ul>${columns[1]}</ul>
                </div>
                <div class="detail-column">
                    <ul>${columns[2]}</ul>
                </div>
            `;
        }
        const dropdownContentForCategories = document.querySelector('.dropdown .dropdown-content');
        if (dropdownContentForCategories) {
            // Click (desktop & mobile): b·∫•m ƒë·ªÉ xem lo·∫°i trong nh√≥m
            dropdownContentForCategories.addEventListener('click', function(e) {
                const item = e.target.closest('.brand-item');
                if (!item || !this.contains(item)) return;

                e.preventDefault();
                e.stopPropagation();

                const categoryName = item.getAttribute('data-category') || item.textContent.trim();
                if (!categoryData[categoryName]) return;
                renderCategoryDetail(categoryName);
            });
        }

        // Click on subcategory to open product listing with pre-selected group/type
        const categoryDetail = document.getElementById('categoryDetail');
        if (categoryDetail) {
            categoryDetail.addEventListener('click', function(e) {
                const li = e.target.closest('.detail-item');
                if (!li) return;
                const group = li.getAttribute('data-group') || '';
                const type = li.getAttribute('data-type') || '';
                const url = `san-pham.html?groups=${encodeURIComponent(group)}&types=${encodeURIComponent(type)}`;
                window.location.href = url;
            });
        }

        // Mobile Dropdown Category Handling
        document.addEventListener('DOMContentLoaded', function() {
            const dropdownBtn = document.querySelector('.dropdown-btn');
            const dropdownContent = document.querySelector('.dropdown-content');
            const hasSubmenu = document.querySelector('.has-submenu');
            
            // L∆∞u HTML g·ªëc c·ªßa dropdown
            const originalDropdownHTML = dropdownContent.innerHTML;
            
            // Icon paths
            const categoryIcons = {
                'Gi∆∞·ªùng': 'icon-hinhdanhmuc/nhom-giuong.png',
                'Xe lƒÉn': 'icon-hinhdanhmuc/nhom-xelan.png',
                'Xe Scooter ƒëi·ªán': 'icon-hinhdanhmuc/nhom-xedien.png',
                'BƒÉng ca': 'icon-hinhdanhmuc/nhom-bangca.png',
                'T·ªß': 'icon-hinhdanhmuc/nhom-tu.png',
                'M√°y t·∫°o oxy': 'icon-hinhdanhmuc/nhom-maytaooxy.png',
                'M√°y ƒëo': 'icon-hinhdanhmuc/nhom-maydo.png',
                'M√°y x√¥ng': 'icon-hinhdanhmuc/nhom-xong.png',
                'M√°y h√∫t d·ªãch': 'icon-hinhdanhmuc/nhom-mayhutdich.png',
                'M√°y massage': 'icon-hinhdanhmuc/nhom-massage.png',
                'Thi·∫øt b·ªã t·∫≠p': 'icon-hinhdanhmuc/nhom-maytap.png',
                'N·ªám': 'icon-hinhdanhmuc/nhom-nem.png',
                'D·ª•ng c·ª• h·ªó tr·ª£': 'icon-hinhdanhmuc/nhom-dungcuhotro.png',
                'Thi·∫øt b·ªã y t·∫ø kh√°c': 'icon-hinhdanhmuc/nhom-thietbiyte.png'
            };
            
            // H√†m t·∫°o HTML cho danh m·ª•c s·∫£n ph·∫©m
            function createCategoryHTML() {
                let gridHTML = '<div class="sheet-category-grid">';
                
                Object.keys(categoryData).forEach(categoryName => {
                    const iconPath = categoryIcons[categoryName] || '';
                    gridHTML += `
                        <div class="sheet-category-item" data-category="${categoryName}">
                            <img src="${iconPath}" alt="${categoryName}" class="sheet-category-icon">
                            <span class="sheet-category-name">${categoryName}</span>
                        </div>
                    `;
                });
                
                gridHTML += '</div>';
                
                return `
                    <div class="dropdown-category-header">
                        <button class="dropdown-category-back">‚Äπ</button>
                        <h3>Danh m·ª•c s·∫£n ph·∫©m</h3>
                    </div>
                    <div class="dropdown-category-content">
                        ${gridHTML}
                    </div>
                `;
            }
            
            // X·ª≠ l√Ω click tr√™n dropdown (event delegation)
            dropdownContent.addEventListener('click', function(e) {
                e.stopPropagation();
                
                // N·∫øu click v√†o "S·∫£n ph·∫©m" tr√™n mobile
                if (window.innerWidth <= 768 && e.target.classList.contains('has-submenu')) {
                    e.preventDefault();
                    dropdownContent.innerHTML = createCategoryHTML();
                    dropdownContent.style.display = 'block';
                }
                // N·∫øu click v√†o n√∫t back
                else if (e.target.classList.contains('dropdown-category-back')) {
                    dropdownContent.innerHTML = originalDropdownHTML;
                    dropdownContent.style.display = 'block';
                    // G·∫Øn l·∫°i s·ª± ki·ªán cho dropdown m·ªõi
                    setTimeout(attachDropdownEvents, 0);
                }
                // N·∫øu click v√†o m·ªôt nh√≥m s·∫£n ph·∫©m
                else if (e.target.closest('.sheet-category-item')) {
                    const categoryItem = e.target.closest('.sheet-category-item');
                    const categoryName = categoryItem.getAttribute('data-category');
                    // ƒê√≥ng dropdown
                    dropdownContent.style.display = 'none';
                    const targetUrl = `san-pham.html?groups=${encodeURIComponent(categoryName)}`;
                    window.location.href = targetUrl;
                }
                // N·∫øu click v√†o c√°c link kh√°c (Trang ch·ªß, Gi·ªõi thi·ªáu, ...)
                else if (e.target.tagName === 'A' && e.target.getAttribute('href') && e.target.getAttribute('href') !== '#') {
                    // ƒê√≥ng dropdown
                    dropdownContent.style.display = 'none';
                }
            });
            
            // H√†m g·∫Øn s·ª± ki·ªán cho dropdown
            function attachDropdownEvents() {
                // ƒê·∫£m b·∫£o dropdown hi·ªÉn th·ªã ƒë√∫ng tr√™n mobile
                if (window.innerWidth <= 768) {
                    dropdownContent.style.position = 'fixed';
                    dropdownContent.style.top = '100px';
                    dropdownContent.style.left = '10px';
                    dropdownContent.style.right = '10px';
                    dropdownContent.style.width = 'calc(100% - 20px)';
                }
            }
            
            // X·ª≠ l√Ω n√∫t "Danh m·ª•c"
            if (dropdownBtn) {
                dropdownBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    if (dropdownContent.style.display === 'block') {
                        dropdownContent.style.display = 'none';
                    } else {
                        // Reset v·ªÅ menu ch√≠nh khi m·ªü dropdown
                        if (window.innerWidth <= 768) {
                            dropdownContent.innerHTML = originalDropdownHTML;
                            attachDropdownEvents();
                        }
                        dropdownContent.style.display = 'block';
                    }
                });
            }
            
            // ƒê√≥ng dropdown khi click ra ngo√†i
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.dropdown') && !e.target.closest('.dropdown-content')) {
                    dropdownContent.style.display = 'none';
                }
            });
            
            // Kh·ªüi t·∫°o
            attachDropdownEvents();
            
            // X·ª≠ l√Ω khi resize window
            window.addEventListener('resize', function() {
                if (window.innerWidth > 768) {
                    dropdownContent.innerHTML = originalDropdownHTML;
                    dropdownContent.style.position = '';
                    dropdownContent.style.top = '';
                    dropdownContent.style.left = '';
                    dropdownContent.style.right = '';
                    dropdownContent.style.width = '';
                    dropdownContent.style.display = '';
                } else {
                    attachDropdownEvents();
                }
            });
        });
    </script>   
    <section class="quote-section">
        <div class="container">
            <div class="quote-background">
                <div class="quote-content">
                    <div class="quote-left">
                        <h2>ƒêƒÇNG K√ù T∆Ø V·∫§N</h2>
                        <p>Nh·∫≠n t∆∞ v·∫•n mi·ªÖn ph√≠ t·ª´ ƒë·ªôi ng≈© chuy√™n gia.</p>
                    </div>
                    <div class="quote-form">
                        <form id="consultForm">
                            <div class="form-row">
                                <input id="consultName" type="text" placeholder="H·ªç v√† t√™n *" required>
                                <input id="consultPhone" type="tel" placeholder="S·ªë ƒëi·ªán tho·∫°i *" required>
                            </div>
                            <input id="consultEmail" type="email" placeholder="Email">
                            <textarea id="consultMessage" placeholder="N·ªôi dung c·∫ßn t∆∞ v·∫•n..."></textarea>
                            <button id="consultSubmit" type="submit" class="quote-btn">G·ª¨I TH√îNG TIN</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>H·ªó tr·ª£ kh√°ch h√†ng</h3>
                    <ul>
                        <li>Hotline: 0937 043 808</li>
                        <li>(8-21h k·ªÉ c·∫£ T7, CN)</li>
                        <li>ƒêi·ªÅu kho·∫£n d·ªãch v·ª•</li>
                        <li>Ch√≠nh s√°ch ph·ª•c v·ª•</li>
                        <li>Ch√≠nh s√°ch ƒë·ªïi tr·∫£</li>
                        <li>Ch√≠nh s√°ch b·∫£o m·∫≠t</li>
                        <li>Ch√≠nh s√°ch v·∫≠n chuy·ªÉn</li>
                        <li>Ch√≠nh s√°ch thanh to√°n</li>
                        <li>Ch√≠nh s√°ch b·∫£o h√†nh</li>
                        <li>H·ªó tr·ª£ kh√°ch h√†ng: ducphuongmedical@gmail.com</li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h3>B·∫£n tin s·ª©c kh·ªèe</h3>
                    <ul>
                        <li>Tin t·ª©c v·ªÅ gi∆∞·ªùng b·ªánh nh√¢n</li>
                        <li>H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng gi∆∞·ªùng b·ªánh</li>
                        <li>H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng xe lƒÉn ƒëi·ªán</li>
                        <li>Tin t·ª©c v·ªÅ m√°y t·∫°o Oxy</li>
                        <li>Tin t·ª©c v·ªÅ Xe LƒÉn</li>
                    </ul>
                    

                </div>
                
                <div class="footer-column">
                    <h3>Ph∆∞∆°ng th·ª©c thanh to√°n</h3>
                    <div class="payment-methods">
                        <img src="hinh-thanhtoan/visa.png" alt="Visa">
                        <img src="hinh-thanhtoan/mastercard.png" alt="Mastercard">
                        <img src="hinh-thanhtoan/jcb.png" alt="JCB">
                        <img src="hinh-thanhtoan/momo.png" alt="MoMo">
                    </div>
                    
                    <h4>D·ªãch v·ª• giao h√†ng</h4>
                    <div class="delivery-services">
                        <img src="hinh-anh/giao-hang.png" alt="Giao h√†ng">
                    </div>
                </div>
                
                <div class="footer-column">
                    <h3>K·∫øt n·ªëi v·ªõi ch√∫ng t√¥i</h3>
                    <div class="social-links">
                        <a href="https://www.facebook.com/ducphuongnguyenphuoctay" target="_blank">
                            <img src="hinh-anh/fb-logo.png" alt="Facebook">
                        </a>
                        <a href="https://youtube.com/@ducphuongmedical" target="_blank">
                            <img src="hinh-anh/youtube-icon.png" alt="YouTube">
                        </a>
                        <a href="https://zalo.me/0938.062.808" target="_blank">
                            <img src="hinh-anh/icon-zalo.png" alt="Zalo">
                        </a>
                        <a href="https://mail.google.com/mail/?view=cm&fs=1&to=ducphuongmedical@gmail.com" target="_blank">
                            <img src="hinh-anh/icon-gmail.png" alt="Gmail">
                        </a>
                    </div>
                    
                    <div class="certificates">
                        <h4>Ch·ª©ng nh·∫≠n b·ªüi</h4>
                        <div class="cert-logos">
                            <img src="hinh-anh/icon-ddk.png" alt="ƒê√£ ƒëƒÉng k√Ω">
                        </div>
                    </div>
                    

                </div>
            </div>
            
            <div class="footer-bottom">
                <div class="footer-bottom-content">
                    <div class="company-info">
                        <p>ƒê·ªãa ch·ªâ: 12 ƒê√¥ng H·ªì, Ph∆∞·ªùng 08, Qu·∫≠n T√¢n B√¨nh, TP.HCM</p>
                        <p>TaJerMy nh·∫≠n ƒë·∫∑t h√†ng tr·ª±c tuy·∫øn v√† giao h√†ng t·∫≠n n∆°i ho·∫∑c mua h√†ng tr·ª±c ti·∫øp t·∫°i c·ª≠a h√†ng</p>
                        <p>Gi·∫•y ch·ª©ng nh·∫≠n ƒêƒÉng k√Ω Kinh doanh s·ªë 0313717853 do S·ªü K·∫ø ho·∫°ch v√† ƒê·∫ßu t∆∞ Th√†nh ph·ªë H·ªì Ch√≠ Minh c·∫•p ng√†y 25/03/2016</p>
                        <p>&copy; 2022 - B·∫£n quy·ªÅn c·ªßa TaJerMy - www.ducphuongmedical.com. C·∫•m sao ch√©p d∆∞·ªõi m·ªçi h√¨nh th·ª©c n·∫øu kh√¥ng c√≥ s·ª± ch·∫•p thu·∫≠n b·∫±ng vƒÉn b·∫£n.</p>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <div class="phone-contact">
        <a href="tel:0938062808" data-uid="contact-phone">
            <img src="hinh-anh/icon-dt.png" alt="ƒêi·ªán tho·∫°i">
        </a>
    </div>
    <div class="cskh-contact" onclick="toggleChat()">
        <img src="hinh-anh/icon-cskh.png" alt="CSKH">
    </div>
    <div class="zalo-contact">
        <a href="https://zalo.me/0938.062.808" target="_blank" data-uid="contact-zalo">
            <img src="hinh-anh/icon-zalo.png" alt="Zalo">
        </a>
    </div>
    <div class="youtube-contact">
        <a href="https://www.youtube.com/@ducphuongmedical" target="_blank" data-uid="contact-youtube">
            <img src="hinh-anh/youtube-icon.png" alt="YouTube">
        </a>
    </div>
    <div class="facebook-contact">
        <a href="https://www.facebook.com/ducphuongnguyenphuoctay" target="_blank" data-uid="contact-facebook">
            <img src="hinh-anh/fb-logo.png" alt="Facebook">
        </a>
    </div>
    
    <div class="chat-box" id="chatBox" style="display:none; position:fixed; right:20px; bottom:80px; width:360px; max-width:95vw; height:460px; max-height:70vh; background:#fff; border:1px solid #e5e7eb; border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,0.15); overflow:hidden; flex-direction:column;">
        <div class="chat-header" style="display:flex; align-items:center; justify-content:space-between; padding:10px; border-bottom:1px solid #eee;">
            <span>H·ªó tr·ª£ tr·ª±c tuy·∫øn</span>
            <span class="close-chat" onclick="toggleChat()" style="cursor:pointer">&times;</span>
        </div>
        <div id="chatThreadCustomer" style="flex:1; overflow:auto; background:#fafafa; padding:10px 0;"></div>
        <div id="typingIndicatorCustomer" style="padding:6px 12px; font-size:12px; color:#6b7280; display:none">ƒêang nh·∫≠p...</div>
        <div class="chat-input" style="display:flex; gap:8px; padding:10px; border-top:1px solid #eee; background:#fff; align-items:center;">
            <input type="text" id="cskhMessageInput" placeholder="Nh·∫≠p tin nh·∫Øn..." style="flex:1; padding:10px; border:1px solid #ddd; border-radius:8px;">
            <input type="file" id="cskhFile" style="display:none">
            <button onclick="document.getElementById('cskhFile').click()" class="continue-btn" style="width:42px; height:42px; min-width:42px; padding:0; display:flex; align-items:center; justify-content:center; background:#f1f5f9; border:1px solid #e5e7eb;">
                <img src="hinh-anh/icon-file.png" alt="T·ªáp" style="width:20px; height:20px; object-fit:contain;">
            </button>
            <button onclick="sendSupportMessage()" class="continue-btn" style="background:#0d6efd">G·ª≠i</button>
        </div>
    </div>
    
    <!-- Certificate Modal -->
    <div id="certModal" class="cert-modal">
        <div class="cert-modal-content">
            <span class="cert-close" onclick="closeCertModal()">&times;</span>
            <img id="certModalImg" src="" alt="">
        </div>
    </div>
    
    <!-- Mobile Category Bottom Sheet -->
    <div class="sheet-overlay" id="sheetOverlay" onclick="closeMobileCategorySheet()"></div>
    <div class="mobile-category-sheet" id="mobileCategorySheet">
        <div class="sheet-header">
            <h3>Danh m·ª•c s·∫£n ph·∫©m</h3>
            <span class="sheet-close" onclick="closeMobileCategorySheet()">&times;</span>
        </div>
        <div class="sheet-content" id="sheetContent">
            <!-- Content will be populated by JavaScript -->
        </div>
    </div>
    
    <script>
        function toggleChat() {
            const chatBox = document.getElementById('chatBox');
            const show = chatBox.style.display === 'none' || chatBox.style.display === '';
            chatBox.style.display = show ? 'flex' : 'none';
            if (show) { initCustomerChat(); }
            else { stopCustomerPoll(); }
        }
        
        function openCertModal(imgSrc, altText) {
            const modal = document.getElementById('certModal');
            const modalImg = document.getElementById('certModalImg');
            modal.style.display = 'flex';
            modalImg.src = imgSrc;
            modalImg.alt = altText;
        }
        
        function closeCertModal() {
            document.getElementById('certModal').style.display = 'none';
        }
function updateCarouselForMobile() {
    const isMobile = window.innerWidth <= 768;
    
    if (isMobile) {
        slidesToShow = 2; 
        maxIndex = totalItems - slidesToShow;
        
    
    } else {
        
        slidesToShow = 3; 
        maxIndex = totalItems - slidesToShow;
    }
    
    if (currentCarouselIndex > maxIndex) {
        currentCarouselIndex = maxIndex;
    }
    updateCarousel();
    updateCarouselButtons();
}

function updateCertForMobile() {
    const isMobile = window.innerWidth <= 768;
    const certItems = document.querySelectorAll('.certificate-item');
    
    if (isMobile) {
       
        maxCertIndex = certItems.length - 1;
    }
    updateCertificate();
}

window.addEventListener('load', function() {
    updateCarouselForMobile();
    updateCertForMobile();
});

window.addEventListener('resize', function() {
    updateCarouselForMobile();
    updateCertForMobile();
});

    // Unified Dropdown & Mobile Menu Logic
    document.addEventListener('DOMContentLoaded', function() {
        const dropdown = document.querySelector('.dropdown');
        if (!dropdown) return;

        const dropdownBtn = dropdown.querySelector('.dropdown-btn');
        const dropdownContent = dropdown.querySelector('.dropdown-content');
        
        // Store the original HTML of the main menu
        const originalMenuHTML = dropdownContent.innerHTML;

        // Data for building category views
        const categoryIcons = {
            'Gi∆∞·ªùng': 'icon-hinhdanhmuc/nhom-giuong.png',
            'Xe lƒÉn': 'icon-hinhdanhmuc/nhom-xelan.png',
            'Xe Scooter ƒëi·ªán': 'icon-hinhdanhmuc/nhom-xedien.png',
            'BƒÉng ca': 'icon-hinhdanhmuc/nhom-bangca.png',
            'T·ªß': 'icon-hinhdanhmuc/nhom-tu.png',
            'M√°y t·∫°o oxy': 'icon-hinhdanhmuc/nhom-maytaooxy.png',
            'M√°y ƒëo': 'icon-hinhdanhmuc/nhom-maydo.png',
            'M√°y x√¥ng': 'icon-hinhdanhmuc/nhom-xong.png',
            'M√°y h√∫t d·ªãch': 'icon-hinhdanhmuc/nhom-mayhutdich.png',
            'M√°y massage': 'icon-hinhdanhmuc/nhom-massage.png',
            'Thi·∫øt b·ªã t·∫≠p': 'icon-hinhdanhmuc/nhom-maytap.png',
            'N·ªám': 'icon-hinhdanhmuc/nhom-nem.png',
            'D·ª•ng c·ª• h·ªó tr·ª£': 'icon-hinhdanhmuc/nhom-dungcuhotro.png',
            'Thi·∫øt b·ªã y t·∫ø kh√°c': 'icon-hinhdanhmuc/nhom-thietbiyte.png'
        };

        let currentCategoryForSub = null;

        // Function to generate the HTML for the product categories grid
        function createProductCategoryHTML() {
            let gridHTML = '<div class="mobile-category-grid">';
            Object.keys(categoryData).forEach(categoryName => {
                const iconPath = categoryIcons[categoryName] || '';
                gridHTML += `
                    <div class="mobile-category-item" data-category="${categoryName}">
                        <img src="${iconPath}" alt="${categoryName}" class="mobile-category-icon">
                        <span>${categoryName}</span>
                    </div>
                `;
            });
            gridHTML += '</div>';

            return `
                <div class="mobile-menu-header">
                    <button class="mobile-menu-back-btn">‚Äπ Quay l·∫°i</button>
                    <h3>Danh m·ª•c s·∫£n ph·∫©m</h3>
                </div>
                ${gridHTML}
            `;
        }
        
        // Function to generate sub-category list
        function createSubCategoryHTML(categoryName) {
            const subcategories = categoryData[categoryName] || [];
            let listHTML = '';
            if (subcategories.length > 0) {
                subcategories.forEach(sub => {
                    listHTML += `<div class="mobile-subcategory-item">${sub}</div>`;
                });
            } else {
                listHTML = '<div>Kh√¥ng c√≥ s·∫£n ph·∫©m con.</div>';
            }

            return `
                <div class="mobile-menu-header">
                    <button class="mobile-menu-back-btn" data-target="main-categories">‚Äπ Danh m·ª•c</button>
                    <h3>${categoryName}</h3>
                </div>
                <div class="mobile-subcategory-list">${listHTML}</div>
            `;
        }

        // Main click handler for the "Danh m·ª•c" button
        dropdownBtn.addEventListener('click', function(event) {
            if (window.innerWidth <= 768) {
                event.preventDefault();
                event.stopPropagation();
                dropdown.classList.toggle('mobile-menu-active');
            }
        });

        // Event delegation for handling clicks inside the mobile menu
        dropdownContent.addEventListener('click', function(event) {
            if (window.innerWidth > 768) return; // Only run on mobile

            const target = event.target;

            // Click on "S·∫£n ph·∫©m" to show product categories
            if (target.matches('.has-submenu')) {
                event.preventDefault();
                dropdownContent.innerHTML = createProductCategoryHTML();
            }

            // Click on the "Back" button
            if (target.matches('.mobile-menu-back-btn')) {
                const backTarget = target.getAttribute('data-target');
                if (backTarget === 'main-categories') {
                     dropdownContent.innerHTML = createProductCategoryHTML();
                } else {
                     dropdownContent.innerHTML = originalMenuHTML;
                }
            }

            // Click on a main product category to see sub-categories
            const categoryItem = target.closest('.mobile-category-item');
            if (categoryItem) {
                const categoryName = categoryItem.getAttribute('data-category');
                if (categoryName) {
                    currentCategoryForSub = categoryName;
                    dropdown.classList.remove('mobile-menu-active');
                    const targetUrl = `san-pham.html?groups=${encodeURIComponent(categoryName)}`;
                    window.location.href = targetUrl;
                }
            }
            
            // Clicking a subcategory item should eventually lead to a new page
            const subCategoryItem = target.closest('.mobile-subcategory-item');
            if (subCategoryItem) {
                const subName = subCategoryItem.textContent.trim();
                const groupName = currentCategoryForSub || '';
                const targetUrl = groupName
                    ? `san-pham.html?groups=${encodeURIComponent(groupName)}&types=${encodeURIComponent(subName)}`
                    : `san-pham.html?types=${encodeURIComponent(subName)}`;
                dropdown.classList.remove('mobile-menu-active');
                window.location.href = targetUrl;
            }
        });

        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768) {
                if (!dropdown.contains(event.target)) {
                    dropdown.classList.remove('mobile-menu-active');
                }
            }
        });
        
         // Reset on resize
        window.addEventListener('resize', function() {
            dropdown.classList.remove('mobile-menu-active');
            dropdownContent.innerHTML = originalMenuHTML;
            // revert desktop hover behavior
            if (window.innerWidth > 768) {
                dropdownContent.style.display = '';
            }
        });
    });

    // Hi·ªáu ·ª©ng xu·∫•t hi·ªán t·ª´ t·ª´ (Reveal Animation)
    function reveal() {
        var reveals = document.querySelectorAll(".reveal");
        for (var i = 0; i < reveals.length; i++) {
            var windowHeight = window.innerHeight;
            var elementTop = reveals[i].getBoundingClientRect().top;
            var elementVisible = 50;
            if (elementTop < windowHeight - elementVisible) {
                reveals[i].classList.add("active");
            }
        }
    }
    window.addEventListener("scroll", reveal);
    // K√≠ch ho·∫°t ngay khi t·∫£i trang
    reveal();

    // --- LOGIC ƒê·ªíNG B·ªò D·ªÆ LI·ªÜU T·ª™ TRANG QU·∫¢N TR·ªä ---
    document.addEventListener('DOMContentLoaded', function() {
        initializeContentSync();
    });

    function initializeContentSync() {
        // 1. G√°n ID duy nh·∫•t (Logic ph·∫£i GI·ªêNG H·ªÜT trang qu·∫£n tr·ªã ƒë·ªÉ kh·ªõp ID)
        const images = document.querySelectorAll('header img, main img, footer img'); // Select images from main content areas
        images.forEach((img, index) => {
            if (!img.hasAttribute('data-uid')) {
                img.setAttribute('data-uid', 'img-' + index);
            }
        });

        const textTags = ['h1', 'h2', 'h3', 'h4', 'h5', 'p', 'span', 'li', 'a', 'td', 'th'];
        let textIndex = 0;
        textTags.forEach(tagName => {
            document.querySelectorAll(`header ${tagName}, main ${tagName}, footer ${tagName}`).forEach(el => {
                if (!el.hasAttribute('data-uid') && el.innerText.trim().length > 0) {
                    el.setAttribute('data-uid', 'txt-' + textIndex++);
                }
            });
        });

        // 2. Load d·ªØ li·ªáu v√† l·∫Øng nghe thay ƒë·ªïi
        applySavedContent();
        
        // L·∫Øng nghe s·ª± ki·ªán thay ƒë·ªïi storage (khi admin c·∫≠p nh·∫≠t ·ªü tab kh√°c)
        window.addEventListener('storage', function(e) {
            if (e.key === 'siteContent') {
                applySavedContent();
            }
        });
    }

    function applySavedContent() {
        const savedData = JSON.parse(localStorage.getItem('siteContent') || '{}');
        for (const [uid, value] of Object.entries(savedData)) {
            const element = document.querySelector(`[data-uid="${uid}"]`);
            if (element) {
                if (uid.startsWith('img-')) {
                    element.src = value;
                } else if (uid.startsWith('contact-')) {
                    element.href = value;
                } else {
                    element.innerText = value;
                }
            }
        }
    }
    
    // ===== CSKH: Chat hai chi·ªÅu cho kh√°ch h√†ng =====
    let CUSTOMER_PEER_ID = null;
    let CUSTOMER_POLL = null;
    function initCustomerChat(){
        fetch('/messages.php', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({action:'whoami'}) })
            .then(r=>r.json()).then(d=>{
                if (d.status==='success') {
                    CUSTOMER_PEER_ID = d.sender_id;
                    loadCustomerThread();
                    markCustomerRead();
                    connectWSCustomer(d.sender_id, d.username || 'Kh√°ch h√†ng');
                    startCustomerPoll();
                }
            });
    }
    function renderCustomerBubble(m){
        const isAdminSide = (m.sender_id === 0);
        const wrap = document.createElement('div');
        wrap.style.display='flex'; wrap.style.padding='4px 12px'; wrap.style.justifyContent = isAdminSide ? 'flex-start' : 'flex-end';
        const bubble = document.createElement('div');
        bubble.style.maxWidth='80%'; bubble.style.padding='8px 10px'; bubble.style.borderRadius='12px';
        bubble.style.background = isAdminSide ? '#fff' : '#dbeafe'; bubble.style.border = '1px solid #e5e7eb';
        bubble.innerHTML = m.is_recalled ? '<em>Tin nh·∫Øn ƒë√£ ƒë∆∞·ª£c thu h·ªìi</em>' : (m.message_type==='text' ? (m.content||'') : (m.message_type==='image' ? `<img src="${m.attachment_path}" style="max-width:100%">` : (m.message_type==='file' ? `<a href="${m.attachment_path}" target="_blank">T·∫≠p tin</a>` : (m.message_type==='emoji' ? m.content : m.content))));
        const time = document.createElement('div');
        const ticks = (!isAdminSide && m.status==='read') ? '‚úì‚úì' : (!isAdminSide ? '‚úì' : '');
        time.textContent = new Date(m.created_at).toLocaleString('vi-VN') + (ticks ? (' ‚Ä¢ ' + ticks) : '');
        time.style.fontSize='11px'; time.style.color='#6b7280'; time.style.marginTop='4px';
        bubble.appendChild(time);
        wrap.appendChild(bubble);
        return wrap;
    }
    function loadCustomerThread(){
        if (CUSTOMER_PEER_ID === null) return;
        fetch('/messages.php', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({action:'list_messages', peer_id:CUSTOMER_PEER_ID, limit:300}) })
            .then(r=>r.json()).then(d=>{
                if (d.status==='success') {
                    const box = document.getElementById('chatThreadCustomer');
                    box.innerHTML='';
                    (d.messages||[]).forEach(m => box.appendChild(renderCustomerBubble(m)));
                    box.scrollTop = box.scrollHeight;
                    markCustomerRead();
                }
            });
    }
    function markCustomerRead(){
        fetch('/messages.php', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({action:'mark_read_user'}) });
    }
    // Emoji removed as requested
    function sendSupportMessage(){
        const input = document.getElementById('cskhMessageInput'); const file = document.getElementById('cskhFile');
        const text = (input.value||'').trim();
        if (!text && !(file.files && file.files[0])) { return; }
        if (file.files && file.files[0]) {
            const fd = new FormData(); fd.append('file', file.files[0]);
            fetch('/upload_chat_attachment.php', { method:'POST', body: fd }).then(r=>r.json()).then(res=>{
                if (res.status==='success') {
                    return fetch('/messages.php', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ action:'send', receiver_id:0, message_type:'image', attachment_path:res.path, content:'' }) });
                } else { throw new Error('Upload th·∫•t b·∫°i'); }
            }).then(()=>{ file.value=''; loadCustomerThread(); }).catch(()=> alert('Kh√¥ng th·ªÉ g·ª≠i t·ªáp.'));
        } else {
            fetch('/messages.php', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ action:'send', receiver_id:0, message_type:'text', content:text, from_page:'index.html' }) })
                .then(r=>r.json()).then(d=>{ if (d.status==='success'){ input.value=''; loadCustomerThread(); if (window.wsCust) { try { window.wsCust.send(JSON.stringify({type:'message', from:CUSTOMER_PEER_ID, to:0 })); } catch {} } } });
        }
    }

    // Typing from customer
    (function(){
        let tmr = null;
        const input = document.getElementById('cskhMessageInput');
        input && input.addEventListener('input', function(){
            if (!window.wsCust || window.wsCust.readyState !== 1 || CUSTOMER_PEER_ID === null) return;
            try { window.wsCust.send(JSON.stringify({type:'typing', from:CUSTOMER_PEER_ID, to:0, active:true})); } catch {}
            if (tmr) clearTimeout(tmr);
            tmr = setTimeout(function(){ try { window.wsCust.send(JSON.stringify({type:'typing', from:CUSTOMER_PEER_ID, to:0, active:false})); } catch {} }, 1500);
        });
    })();

    // WebSocket for customer
    function connectWSCustomer(senderId, username){
        try {
            window.wsCust = new WebSocket('ws://localhost:9000');
            window.wsCust.onopen = function(){
                window.wsCust.send(JSON.stringify({type:'hello', sender_id:senderId, username:username, role:'khach-hang'}));
            };
            window.wsCust.onmessage = function(ev){
                let msg = {}; try { msg = JSON.parse(ev.data); } catch { return; }
                if (msg.type === 'message' && msg.to === senderId) {
                    loadCustomerThread();
                }
                if (msg.type === 'typing' && msg.from === 0) {
                    const ind = document.getElementById('typingIndicatorCustomer');
                    ind.style.display = msg.active ? 'block' : 'none';
                }
                if (msg.type === 'presence' && msg.sender_id === 0) {
                    // Could display admin status somewhere if needed
                }
            };
        } catch (e) { /* ignore */ }
    }

    function startCustomerPoll(){
        if (CUSTOMER_POLL) return;
        CUSTOMER_POLL = setInterval(loadCustomerThread, 8000);
    }
    function stopCustomerPoll(){
        if (CUSTOMER_POLL) { clearInterval(CUSTOMER_POLL); CUSTOMER_POLL = null; }
    }

    // Lead: g·ª≠i form t∆∞ v·∫•n v√†o CSKH (messages.php)
    (function initConsultForm(){
        const form = document.getElementById('consultForm');
        if (!form) return;
        const nameInput = document.getElementById('consultName');
        const phoneInput = document.getElementById('consultPhone');
        const emailInput = document.getElementById('consultEmail');
        const msgInput = document.getElementById('consultMessage');
        const submitBtn = document.getElementById('consultSubmit');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = (nameInput?.value || '').trim();
            const phone = (phoneInput?.value || '').trim();
            const email = (emailInput?.value || '').trim();
            const note = (msgInput?.value || '').trim();

            if (!name || !phone) {
                alert('Vui l√≤ng nh·∫≠p H·ªç t√™n v√† S·ªë ƒëi·ªán tho·∫°i.');
                return;
            }

            const payload = {
                action: 'send',
                receiver_id: 0, // admin
                from_page: 'index.html:tu-van',
                content: [
                    'ƒêƒÉng k√Ω t∆∞ v·∫•n',
                    `H·ªç t√™n: ${name}`,
                    `SƒêT: ${phone}`,
                    email ? `Email: ${email}` : null,
                    note ? `N·ªôi dung: ${note}` : null
                ].filter(Boolean).join('\n')
            };

            try {
                submitBtn.disabled = true;
                submitBtn.textContent = 'ƒêang g·ª≠i...';
                const res = await fetch('/messages.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await res.json();
                if (data.status === 'success') {
                    form.reset();
                    alert('G·ª≠i th√¥ng tin th√†nh c√¥ng! CSKH s·∫Ω li√™n h·ªá s·ªõm.');
                } else {
                    alert(data.message || 'G·ª≠i th·∫•t b·∫°i, vui l√≤ng th·ª≠ l·∫°i.');
                }
            } catch (err) {
                console.error('consult submit error', err);
                alert('Kh√¥ng th·ªÉ g·ª≠i th√¥ng tin, vui l√≤ng th·ª≠ l·∫°i.');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'G·ª¨I TH√îNG TIN';
            }
        });
    })();

    // Search functionality with Vietnamese support
    function removeVietnameseTones(str) {
        if (!str) return '';
        str = str.toLowerCase();
        str = str.replace(/√†|√°|·∫°|·∫£|√£|√¢|·∫ß|·∫•|·∫≠|·∫©|·∫´|ƒÉ|·∫±|·∫Ø|·∫∑|·∫≥|·∫µ/g, 'a');
        str = str.replace(/√®|√©|·∫π|·∫ª|·∫Ω|√™|·ªÅ|·∫ø|·ªá|·ªÉ|·ªÖ/g, 'e');
        str = str.replace(/√¨|√≠|·ªã|·ªâ|ƒ©/g, 'i');
        str = str.replace(/√≤|√≥|·ªç|·ªè|√µ|√¥|·ªì|·ªë|·ªô|·ªï|·ªó|∆°|·ªù|·ªõ|·ª£|·ªü|·ª°/g, 'o');
        str = str.replace(/√π|√∫|·ª•|·ªß|≈©|∆∞|·ª´|·ª©|·ª±|·ª≠|·ªØ/g, 'u');
        str = str.replace(/·ª≥|√Ω|·ªµ|·ª∑|·ªπ/g, 'y');
        str = str.replace(/ƒë/g, 'd');
        return str;
    }

    (function initSearch() {
        const searchInput = document.querySelector('.search-input');
        const searchBtn = document.querySelector('.search-btn');
        const suggestionsBox = document.getElementById('searchSuggestions');
        
        if (!searchInput || !searchBtn) return;
        
        searchBtn.addEventListener('click', () => {
            const query = searchInput.value.trim();
            if (query) {
                window.location.href = `san-pham.html?search=${encodeURIComponent(query)}`;
            }
        });
        
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const query = searchInput.value.trim();
                if (query) {
                    window.location.href = `san-pham.html?search=${encodeURIComponent(query)}`;
                }
            }
        });
        
        // Close suggestions when clicking outside
        document.addEventListener('click', (e) => {
            if (suggestionsBox && !searchInput?.contains(e.target) && !suggestionsBox?.contains(e.target) && !searchBtn?.contains(e.target)) {
                suggestionsBox.classList.remove('show');
            }
        });
    })();

    // Load Featured Products with Rating
    (async function loadFeaturedProducts() {
        const grid = document.getElementById('featuredProductsGrid');
        if (!grid) return;

        // Helper function to format currency
        function formatCurrency(val) {
            return val ? val.toLocaleString('vi-VN') + ' ‚Ç´' : 'ƒêang c·∫≠p nh·∫≠t';
        }

        try {
            const response = await fetch('api/admin_product_list.php');
            if (!response.ok) {
                throw new Error('HTTP ' + response.status + ' khi g·ªçi api/admin_product_list.php');
            }
            const data = await response.json();
            
            if (!data.success || !data.data) {
                console.error('API admin_product_list.php tr·∫£ v·ªÅ l·ªói:', data);
                throw new Error('Kh√¥ng th·ªÉ t·∫£i s·∫£n ph·∫©m t·ª´ API');
            }

            // Filter out products without price, then generate random ratings
            // In production, this should come from actual user ratings
            const productsWithRating = data.data
                .filter(p => {
                    // Only include products that have a valid price
                    const sale = parseFloat(p.sale_price);
                    const price = parseFloat(p.price);
                    const original = parseFloat(p.original_price);
                    
                    const validSale = !isNaN(sale) && sale > 0;
                    const validPrice = !isNaN(price) && price > 0;
                    const validOriginal = !isNaN(original) && original > 0;
                    
                    return validSale || validPrice || validOriginal;
                })
                .map(p => ({
                    ...p,
                    rating: (Math.random() * 2 + 3).toFixed(1), // Random rating between 3.0 and 5.0
                    reviews: Math.floor(Math.random() * 500) + 10 // Random reviews 10-510
                }));

            // Sort by rating and get top 12
            const topProducts = productsWithRating
                .sort((a, b) => parseFloat(b.rating) - parseFloat(a.rating))
                .slice(0, 12);

            // Render products compact style
            grid.innerHTML = '';
            topProducts.forEach(p => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.style.cursor = 'pointer';
                card.onclick = () => window.location.href = 'san-pham.html?id=' + p.id;
                
                const imgSrc = p.thumbnail_path || p.image || 'https://via.placeholder.com/300x200?text=Product';
                const salePrice = parseFloat(p.sale_price);
                const mainPrice = parseFloat(p.price);
                const originalPrice = parseFloat(p.original_price);
                const priceVal = (!isNaN(salePrice) && salePrice > 0)
                    ? salePrice
                    : (!isNaN(mainPrice) && mainPrice > 0)
                        ? mainPrice
                        : (!isNaN(originalPrice) && originalPrice > 0 ? originalPrice : 0);
                const originalVal = (!isNaN(originalPrice) && originalPrice > 0) ? originalPrice : 0;
                const showOriginal = originalVal && priceVal && originalVal > priceVal;
                const priceHtml = `
                    <div class="product-price">${priceVal ? formatCurrency(priceVal) : 'ƒêang c·∫≠p nh·∫≠t'}</div>
                    ${showOriginal ? `<div style="color: #6b7280; text-decoration: line-through; font-size: 13px; margin-top: 2px;">${formatCurrency(originalVal)}</div>` : ''}
                `;

                const rating = parseFloat(p.rating);
                const fullStars = Math.floor(rating);
                const hasHalfStar = rating % 1 >= 0.5;
                const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);

                let starsHTML = '';
                for (let i = 0; i < fullStars; i++) {
                    starsHTML += '<span style="color: #f59e0b;">‚òÖ</span>';
                }
                if (hasHalfStar) {
                    starsHTML += '<span style="color: #f59e0b;">‚òÖ</span>';
                }
                for (let i = 0; i < emptyStars; i++) {
                    starsHTML += '<span style="color: #e5e7eb;">‚òÖ</span>';
                }

                card.innerHTML = `
                    <img src="${imgSrc}" alt="${p.name || ''}" onerror="this.src='https://via.placeholder.com/300x200?text=No+Image'">
                    <div class="product-name">${p.name || 'T√™n s·∫£n ph·∫©m'}</div>
                    ${priceHtml}
                    <div class="product-rating" style="color: #f59e0b; font-size: 13px; margin-top: 4px;">
                        ${starsHTML} <span style="color: #6b7280; font-size: 12px;">(${p.reviews})</span>
                    </div>
                    <div class="product-actions" style="display: flex; gap: 8px; margin-top: 8px;">
                        <button class="btn btn-outline" data-product-id="${p.id}" style="flex: 1; padding: 10px; font-size: 13px;">Xem chi ti·∫øt</button>
                        <button class="btn btn-primary" style="flex: 1; padding: 10px; font-size: 13px;">üõí Mua ngay</button>
                    </div>
                `;
                
                // Remove click from card, add to detail button only
                card.onclick = null;
                const detailBtn = card.querySelector('[data-product-id]');
                if (detailBtn) {
                    detailBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        window.location.href = 'san-pham.html?id=' + p.id;
                    });
                }
                
                grid.appendChild(card);
            });

        } catch (error) {
            console.error('Error loading featured products:', error);
            grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #666;">Kh√¥ng th·ªÉ t·∫£i s·∫£n ph·∫©m</div>';
        }
    })();
</script>
<style>
    /* Skeleton Loading */
    .skeleton-item {
        animation: pulse 1.5s infinite;
    }
    .skeleton-img {
        width: 100%;
        height: 200px;
        background: #e0e0e0;
        border-radius: 8px;
        margin-bottom: 12px;
    }
    .skeleton-text {
        height: 16px;
        background: #e0e0e0;
        border-radius: 4px;
        margin-bottom: 8px;
    }
    .skeleton-text.short {
        width: 60%;
    }
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }

    /* Featured Products Wrapper */
    .featured-products-wrapper {
        background: #fff;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        border: 1px solid #e5e7eb;
    }

    /* Product Grid and Card Styles */
    .product-grid { 
        display: grid; 
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); 
        gap: 14px;
    }
    @media (min-width: 1200px) {
        .product-grid {
            grid-template-columns: repeat(4, 1fr);
        }
    }
    .product-card { 
        background: #fff; 
        border: 1px solid #e5e7eb; 
        border-radius: 12px; 
        padding: 12px; 
        box-shadow: 0 4px 16px rgba(0,0,0,0.04); 
        display: flex; 
        flex-direction: column; 
        gap: 8px; 
        transition: transform 0.15s ease, box-shadow 0.15s ease; 
        cursor: pointer;
        height: 400px; /* Fixed height for consistent card size */
    }
    .product-card:hover { 
        transform: translateY(-2px); 
        box-shadow: 0 8px 24px rgba(0,0,0,0.08);
        border-color: #0d6efd;
    }
    .product-card img { 
        width: 100%; 
        height: 150px; 
        object-fit: cover; 
        border-radius: 10px; 
        background: #f3f4f6;
        flex-shrink: 0; /* Prevent image from shrinking */
    }
    .product-name { 
        font-weight: 700; 
        font-size: 15px; 
        margin: 0;
        color: #333;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        min-height: 42px;
        max-height: 42px;
    }
    .product-price { 
        color: #d97706; 
        font-weight: 700; 
        font-size: 16px;
        margin: 0;
        margin-top: auto; /* Push price to bottom area */
    }
    .product-rating { 
        color: #f59e0b; 
        font-size: 13px; 
    }
    .product-actions { 
        display: flex; 
        gap: 8px; 
    }
    .product-actions .btn { 
        flex: 1; 
        padding: 10px; 
        font-size: 13px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    .product-actions .btn-outline {
        background: white;
        color: #0d6efd;
        border: 1px solid #0d6efd;
    }
    .product-actions .btn-outline:hover {
        background: #0d6efd;
        color: white;
    }
    .product-actions .btn-primary {
        background: #0d6efd;
        color: white;
    }
    .product-actions .btn-primary:hover {
        background: #0b5ed7;
    }
</style>
<script src="search-suggestions.js"></script>
</body>
</html>
</html>